(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{"3GUV":function(e,t,a){"use strict";var r=a("ERkP"),n=a("rHpw"),s=a("MWbm");class i extends r.Component{shouldComponentUpdate(){return!1}render(){return r.createElement(s.a,{style:o.root})}}const o=n.a.create((e=>({root:{height:5*e.lineHeightsPx.body}})));t.a=i},"5UID":function(e,t,a){"use strict";var r=a("ERkP"),n=a("3XMw"),s=a.n(n),i=a("rHpw"),o=a("+/1j"),c=a("MWbm");const l=s.a.e5b0063d;let d=0;class h extends r.Component{constructor(){super(),this._listDomId=`accessible-list-${d}`,d+=1}render(){const{children:e,title:t}=this.props,a=l({title:t});return r.createElement(c.a,{accessibilityLabelledBy:this._listDomId,accessibilityRole:"region"},r.createElement(o.a,{accessibilityLevel:1,accessibilityRole:"heading",nativeID:this._listDomId,style:i.a.visuallyHidden},t),r.createElement(c.a,{accessibilityLabel:a},e))}}t.a=h},Avzu:function(e,t,a){"use strict";var r=a("ERkP"),n=a("Lsrn"),s=a("k/Ka");const i=(e={})=>Object(s.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[n.a.root,e.style],viewBox:"0 0 24 24"},r.createElement("g",null,r.createElement("path",{d:"M23.25 3.25h-2.425V.825c0-.414-.336-.75-.75-.75s-.75.336-.75.75V3.25H16.9c-.414 0-.75.336-.75.75s.336.75.75.75h2.425v2.425c0 .414.336.75.75.75s.75-.336.75-.75V4.75h2.425c.414 0 .75-.336.75-.75s-.336-.75-.75-.75zm-3.175 6.876c-.414 0-.75.336-.75.75v8.078c0 .414-.337.75-.75.75H4.095c-.412 0-.75-.336-.75-.75V8.298l6.778 4.518c.368.246.79.37 1.213.37.422 0 .844-.124 1.212-.37l4.53-3.013c.336-.223.428-.676.204-1.012-.223-.332-.675-.425-1.012-.2l-4.53 3.014c-.246.162-.563.163-.808 0l-7.586-5.06V5.5c0-.414.337-.75.75-.75h9.094c.414 0 .75-.336.75-.75s-.336-.75-.75-.75H4.096c-1.24 0-2.25 1.01-2.25 2.25v13.455c0 1.24 1.01 2.25 2.25 2.25h14.48c1.24 0 2.25-1.01 2.25-2.25v-8.078c0-.415-.337-.75-.75-.75z"})));i.metadata={width:24,height:24},t.a=i},BUB3:function(e,t,a){"use strict";var r=a("ERkP"),n=a("sNn6"),s=a("rHpw"),i=a("MWbm");const o=s.a.create((e=>({activeRoot:{backgroundColor:e.colors.gray0},overlay:{...s.a.absoluteFillObject,borderRightStyle:"solid",borderRightWidth:e.borderWidths.medium,borderRightColor:e.colors.primary,zIndex:1}})));t.a=({children:e,...t})=>r.createElement(n.a,t,(t=>r.createElement(i.a,{style:[t&&o.activeRoot]},"function"==typeof e?e(t):e,t?r.createElement(i.a,{pointerEvents:"none",style:o.overlay}):null)))},TEoO:function(e,t,a){"use strict";var r=a("ERkP"),n=a("5UID"),s=a("3GUV"),i=a("iBK2");const o=r.createElement(s.a,null),c=({accessibilityTitle:e,...t})=>{const a=r.createElement(i.b,t);return e?r.createElement(n.a,{title:e},a):a};c.defaultProps={footer:o},t.a=c},fuhe:function(e,t,a){"use strict";a.r(t),a.d(t,"DMDrawer",(function(){return Ye}));var r=a("97Jx"),n=a.n(r),s=a("KEM+"),i=a.n(s),o=(a("kYxP"),a("ERkP")),c=a("ZUOq"),l=a("MMRb"),d=a("rxPX"),h=a("0KEI"),u=a("RqPI");var p=Object(d.a)().propsFromState((()=>({conversations:l.selectConversations,drawerExperimentEnabled:l.selectDrawerExperimentEnabled,perspective:u.i,poppedOutConversationId:l.selectPoppedOutConversationId,visibility:l.selectDrawerVisibility}))).propsFromActions((()=>({createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_CONVERSATION"),fetchInboxIfNeeded:l.fetchInboxIfNeeded,loadDrawerVisibilityFromPersistence:l.loadDrawerVisibilityFromPersistence,setDrawerVisibility:l.setDrawerVisibility}))),m=a("V/6K"),b=a("VnFT"),g=a("1YZw"),_=a("hqKg"),E=a("Myq3"),y=a("AQOc"),v=a("UhuB"),f=a("l0YN"),I=a("G6rE"),C=a("P1r1");const S=(e,t)=>t.conversationId,x=Object(_.createSelector)(((e,t)=>l.selectEntriesForConversation(e,S(0,t))),u.i,((e,t)=>t?((e,t)=>{const a=Object(E.a)(e,(e=>!!e.message_data&&e.message_data&&e.message_data.recipient_id===t));return a&&a.message_data&&a.message_data.quick_reply&&a.message_data.quick_reply&&"options"===a.message_data.quick_reply.type?a.message_data.quick_reply:void 0})(e,t):void 0)),w=e=>t=>b.c(e,t),R=e=>(t,a)=>b.a(e,t,a),O={conversation:(e,t)=>l.selectConversation(e,S(0,t)),entries:l.selectEntries,perspective:u.i,users:I.e.selectAll,dataSaverMode:C.j,dtabBarInfo:C.m,quickReplyOptions:x,visibility:l.selectDrawerVisibility,inboxUnreadCount:f.a,isUnread:(e,t)=>!l.selectConversationIsRead(e,S(0,t)),isDmReceiptSettingEnabled:v.l},D={draftText:(e,t)=>b.l(e,S(0,t)),gifMetadata:(e,t)=>b.h(e,S(0,t)),isUploading:(e,t)=>b.j(e,S(0,t)),media:(e,t)=>b.i(e,S(0,t)),mediaUploadProgress:(e,t)=>b.k(e,S(0,t))};var M=Object(d.a)().propsFromState((()=>({...O,...D}))).adjustStateProps((({conversation:e,entries:t,perspective:a,users:r,dataSaverMode:n,draftText:s,dtabBarInfo:i,gifMetadata:o,inboxUnreadCount:c,isDmReceiptSettingEnabled:l,isUploading:d,isUnread:h,media:u,mediaUploadProgress:p,quickReplyOptions:m,visibility:b})=>{const g=null==e?void 0:e.data;return{conversation:g&&Object(y.a)(g,t,r),perspective:a,dataSaverMode:n,draftText:s,dtabBarInfo:i,gifMetadata:o,inboxUnreadCount:c,isDmReceiptSettingEnabled:l,isUploading:d,isUnread:h,media:u,mediaUploadProgress:p,quickReplyOptions:m,visibility:b}})).propsFromActions((({conversationId:e})=>({addMedia:R(e),addToast:g.b,createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_CONVERSATION"),fetchConversationHistory:l.fetchConversationHistory,removeMedia:w(e),saveText:b.f,sendMessage:b.m,updateConversationReadState:l.updateConversationReadState,updateTyping:l.updateTyping,fetchUpdatesIfNeeded:l.fetchUpdatesIfNeeded}))).withAnalytics({page:"messages",section:"thread_drawer"}),T=a("aWyx"),k=a("qz2E"),H=(a("uB9N"),a("Oi4X")),N=a("OhSZ"),L=Object(d.a)().propsFromState((()=>({visibility:l.selectDrawerVisibility}))).propsFromActions((()=>({popOutConversation:l.popOutConversation,setDrawerVisibility:l.setDrawerVisibility}))).withAnalytics(),P=a("xPna"),A=a("3XMw"),U=a.n(A),F=a("OrGc"),B=a("hACr"),j=a("fs1G"),V=a("MWbm"),q=a("/yvb"),G=a("Znyr"),W=a("t62R"),Q=a("xKuM"),$=a("rHpw"),z=a("v6aA"),K=a("95Se"),X=a("Avzu"),Y=a("Lsrn"),Z=a("k/Ka");const J=(e={})=>Object(Z.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[Y.a.root,e.style],viewBox:"0 0 24 24"},o.createElement("g",null,o.createElement("path",{d:"M12 19.344l-8.72-8.72c-.293-.293-.768-.293-1.06 0s-.294.768 0 1.06l9.25 9.25c.292.294.767.294 1.06 0l9.25-9.25c.146-.145.22-.337.22-.53s-.073-.383-.22-.53c-.293-.292-.768-.292-1.06 0L12 19.344z"}),o.createElement("path",{d:"M12 11.535l-8.72-8.72c-.293-.293-.768-.293-1.06 0s-.294.768 0 1.06l9.25 9.25c.292.294.767.294 1.06 0l9.25-9.25c.146-.145.22-.337.22-.53s-.073-.383-.22-.53c-.293-.292-.768-.292-1.06 0L12 11.535z"})));J.metadata={width:24,height:24};var ee=J;const te=(e={})=>Object(Z.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[Y.a.root,e.style],viewBox:"0 0 24 24"},o.createElement("g",null,o.createElement("path",{d:"M12 4.656l8.72 8.72c.293.293.768.293 1.06 0s.294-.768 0-1.06l-9.25-9.25c-.292-.294-.767-.294-1.06 0l-9.25 9.25c-.146.145-.22.337-.22.53s.073.383.22.53c.293.292.768.292 1.06 0L12 4.656z"}),o.createElement("path",{d:"M12 12.465l8.72 8.72c.293.293.768.293 1.06 0s.294-.768 0-1.06l-9.25-9.25c-.292-.294-.767-.294-1.06 0l-9.25 9.25c-.146.145-.22.337-.22.53s.073.383.22.53c.293.292.768.292 1.06 0l8.72-8.72z"})));te.metadata={width:24,height:24};var ae=te,re=a("hOZg"),ne=a("x0mb");const se=U.a.a2f8105f,ie=U.a.e839db39,oe=U.a.d227d19e,ce=U.a.c64c1883,le=U.a.j7d0e835,de=U.a.b08821f3,he=U.a.e736990a,ue=U.a.cdcebd22;class pe extends o.Component{constructor(...e){super(...e),i()(this,"_headerBar",o.createRef()),i()(this,"_showDMQuickAccessWithClose",this.context.featureSwitches.isTrue("responsive_web_dm_quick_access_with_close_enabled")),i()(this,"_navVisualRefreshEnabled",this.context.featureSwitches.isTrue("responsive_web_nav_visual_refresh_enabled")),i()(this,"_isExpanded",(()=>{const{visibility:e}=this.props;return e===P.a.EXPANDED})),i()(this,"_renderLeftControl",(()=>{const{inboxUnreadCount:e}=this.props;return o.createElement(V.a,null,o.createElement(q.a,{accessibilityLabel:de,icon:o.createElement(K.a,null),onPress:this._handleUnpopConvo,type:this._getButtonType()}),e&&e>0?o.createElement(G.a,{pip:!0,style:me.newMessagePip,truncatedCountFormatter:()=>"",unreadCountLabel:()=>""}):null)})),i()(this,"_getButtonType",(()=>{let e;const{isHighlighted:t,hasNewMessages:a}=this.props;return e=this._navVisualRefreshEnabled?t&&a?"invertedText":"experimentalText":t&&a?"invertedText":"text",e})),i()(this,"_renderRightControl",(()=>{const{conversationTitle:e}=this.props,t=this._isExpanded(),a=this._getButtonType();return o.createElement(V.a,{style:me.rightControls},e?null:o.createElement(q.a,{accessibilityLabel:ce,hoverLabel:{label:ue},icon:o.createElement(X.a,null),onPress:this._handleNewMessage,type:a}),t?o.createElement(q.a,{accessibilityLabel:oe,hoverLabel:{label:oe},icon:o.createElement(ee,null),onPress:this._handleToggleVisibility,type:a}):o.createElement(q.a,{accessibilityLabel:le,hoverLabel:{label:le},icon:o.createElement(ae,null),onPress:this._handleToggleVisibility,type:a}),this._showDMQuickAccessWithClose?o.createElement(q.a,{accessibilityLabel:ie,icon:o.createElement(re.a,null),onPress:this._handleClose,type:a}):null)})),i()(this,"_handleUnpopConvo",(()=>{const{popOutConversation:e}=this.props;e(null)})),i()(this,"_handleToggleVisibility",(()=>{const{analytics:e,setDrawerVisibility:t,onDrawerOpen:a}=this.props,r=this._isExpanded()?P.a.COLLAPSED:P.a.EXPANDED;r===P.a.COLLAPSED?e.scribe({action:"collapse"}):r===P.a.EXPANDED&&(e.scribe({action:"expand"}),a&&a()),t(r)})),i()(this,"_handleToggleVisibilityKeyboard",(()=>{this._handleToggleVisibility(),this._headerBar&&this._headerBar.current&&this._headerBar.current.focus()})),i()(this,"_handleClose",(()=>{const{analytics:e,setDrawerVisibility:t}=this.props;e.scribe({action:"close"}),t(P.a.CLOSED)})),i()(this,"_handleNewMessage",(()=>{const{analytics:e,history:t}=this.props;e.scribe({section:"compose_drawer",component:"dm",action:"show"}),t.push({pathname:"/messages/compose",state:{source:"drawer"}})})),i()(this,"_renderTitle",(()=>{const{conversationTitle:e,hasNewMessages:t,isHighlighted:a}=this.props,r=e||o.createElement(W.c,null,se);return o.createElement(V.a,{style:me.titleContainer},o.createElement(V.a,{style:[me.titleTextRoot,a&&t?me.titleTextHighlighted:null]},r),t?o.createElement(V.a,{style:me.newMessageDotContainer},o.createElement(ne.a,{accessibilityLabel:he,style:[me.newMessageDotRoot,a?me.newMessageDotHighlighted:me.newMessageDotRegular]})):null)}))}componentDidUpdate(e){const{hasNewMessages:t,isHighlighted:a,triggerHighlight:r}=this.props;e.isHighlighted||a||e.hasNewMessages||!t||r&&r()}render(){const{conversationTitle:e,conversationSubtitle:t,hasNewMessages:a,isHighlighted:r}=this.props,n=a?r?[me.headerHighlighted]:[me.headerActive]:[],s=this._isExpanded();return o.createElement(B.a,{enabled:!0,handlers:{[F.d.goLists]:j.a,[F.d.toggleDMDrawer]:this._handleToggleVisibilityKeyboard}},o.createElement(V.a,{ref:this._headerBar,style:[me.headerRoot,!s&&me.headerBorderClosed,...n,me.cursor,{zIndex:1}]},o.createElement(Q.a,{leftControl:e&&this._isExpanded()?this._renderLeftControl():null,onMiddleControlClick:this._handleToggleVisibility,rightControl:this._renderRightControl(),subtitle:t,title:this._renderTitle(),withBackground:!1})))}}i()(pe,"contextType",z.a);const me=$.a.create((e=>({root:{alignSelf:"flex-end",backgroundColor:e.colors.navigationBackground,borderColor:e.colors.borderColor,borderWidth:e.borderWidths.small,marginRight:e.spaces.space20,width:c.a.columnWidths.secondary.normal},cursor:{cursor:"pointer"},expanded:{height:c.a.columnWidths.secondary.normal},headerRoot:{borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderColor:e.colors.borderColor,borderTopLeftRadius:e.borderRadii.xLarge,borderTopRightRadius:e.borderRadii.xLarge,transition:"all 0.3s ease"},headerBorderClosed:{borderColor:e.colors.navigationBackground},headerActive:{backgroundColor:e.colors.unreadCellBackground},headerHighlighted:{borderColor:e.colors.primary,backgroundColor:e.colors.primary},titleContainer:{alignItems:"center",display:"flex",flexDirection:"row",flexGrow:1},titleTextRoot:{flexGrow:1,flexShrink:1},titleTextHighlighted:{color:e.colors.white},newMessageDotContainer:{flexGrow:1},newMessageDotRoot:{width:e.spaces.space12,height:e.spaces.space12,marginLeft:e.spaces.space4},newMessageDotRegular:{color:e.colors.primary},newMessageDotHighlighted:{color:e.colors.white},newMessagePip:{right:e.spaces.space4,top:e.spaces.space4},rightControls:{flexDirection:"row"}})));var be=L(pe),ge=a("aWzz"),_e=a("XnpN"),Ee=a("zb92");var ye=Object(Ee.a)({loader:()=>Promise.all([a.e(9),a.e(189)]).then(a.bind(null,"Z+oW"))}),ve=a("GSsg"),fe=a("aITJ"),Ie=a("yrzJ");class Ce extends o.Component{constructor(e){super(e),i()(this,"_composer",o.createRef()),i()(this,"_renderConversation",((e,t)=>{const{conversationId:a,history:r,location:n}=this.props;return o.createElement(H.a,{conversationId:a,history:r,isWide:!1,location:n,richTextInputContext:e,typeaheadWrapper:t})})),i()(this,"_isExpanded",(()=>{const{visibility:e}=this.props;return e===P.a.EXPANDED})),i()(this,"_fetchUpdatesIfNeeded",(()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchUpdatesIfNeeded:a,isDmReceiptSettingEnabled:r}=this.props;a(r?{active_conversation_id:e,dm_users:!0}:{}).catch(t())})),Object(k.a)()}componentDidMount(){this._updatePolling()}componentDidUpdate(e){e.visibility!==this.props.visibility&&this._updatePolling()}render(){const{conversation:e,perspective:t,history:a,isUnread:r,inboxUnreadCount:n,isHeaderHighlighted:s,onDrawerOpen:i,triggerHeaderHighlight:c}=this.props,l=this._isExpanded(),d=s?"white":"normal",h=s?"white":"gray700",u=e&&e.type===T.a.ONE_TO_ONE&&t&&Object(_e.a)(e,t).map((({user:e})=>e.screen_name)),p=u?o.createElement(Ie.a,{color:h,screenName:u[0]}):void 0;return o.createElement(o.Fragment,null,o.createElement(be,{conversationSubtitle:p,conversationTitle:o.createElement(N.b,{conversation:e,perspective:t,textColor:d,withScreenName:!1}),hasNewMessages:r,history:a,inboxUnreadCount:n,isHighlighted:s,onDrawerOpen:i,triggerHighlight:c}),l?fe.b.isDesktopOS()?o.createElement(ye,null,(({richTextInputContext:e,typeaheadWrapper:t})=>this._renderConversation(e,t))):this._renderConversation():null)}_updatePolling(){this._pollingTimer&&this._pollingTimer.stop(),this.props.visibility===P.a.COLLAPSED&&(this._pollingTimer=new ve.a(this._fetchUpdatesIfNeeded,{interval:3e3}),this._pollingTimer.start())}getChildContext(){return{getCustomLocation:null}}}i()(Ce,"childContextTypes",{getCustomLocation:ge.func});var Se=M(Ce),xe=a("4q8G"),we=a("kGix"),Re=a("tn7R");var Oe=Object(d.a)().propsFromState((()=>({fetchStatus:l.selectFetchStatus,conversations:l.selectConversations,isLoadingTop:l.selectIsLoadingTop,settings:C.f,unreadCount:f.a,untrustedConversationCount:l.selectUntrustedConversationCount,untrustedUnreadCount:l.selectUntrustedUnreadCount,visibility:l.selectDrawerVisibility}))).adjustStateProps((({fetchStatus:e,conversations:t,isLoadingTop:a,settings:r,unreadCount:n,untrustedConversationCount:s,untrustedUnreadCount:i,visibility:o})=>{const c=!!Object.values(t).length,l=Object(Re.a)(t).filter((e=>{var t;return!e.isDeleted&&(null==(t=e.data)?void 0:t.trusted)})).map((e=>e.data)).sort(xe.a),d=n>0;return{allowUntrustedInbox:"all"===r.allow_dms_from||s>0,conversationIds:l.map((e=>e.conversation_id)),fetchStatus:c?we.a.LOADED:e,isRefreshing:c&&a,isUnread:d,untrustedUnreadCount:i,visibility:o}})).propsFromActions((()=>({createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_INBOX"),fetchInbox:l.fetchInbox,fetchInboxHistory:l.fetchTrustedInboxHistory,fetchInboxIfNeeded:l.fetchInboxIfNeeded,fetchUpdates:l.fetchUpdatesIfNeeded,updateLastSeenEventId:l.updateTrustedLastSeenEventId,popOutConversation:l.popOutConversation}))).withAnalytics({page:"messages",section:"inbox_drawer"}),De=a("qS4/"),Me=a("yw4N"),Te=a("FIs5"),ke=a("csss");const He=U.a.a2f8105f,Ne=U.a.b8aa3744,Le=U.a.j06309e1,Pe=U.a.gee5150a,Ae=U.a.cf2d1047,Ue=U.a.da2f9224,Fe=U.a.h6beb5fa;class Be extends o.Component{constructor(...e){super(...e),i()(this,"_renderExpandedInbox",(()=>{const{analytics:e,conversationIds:t,createLocalApiErrorHandler:a,fetchInbox:r,fetchInboxHistory:n,fetchInboxIfNeeded:s,fetchStatus:i,fetchUpdates:c,isRefreshing:l,updateLastSeenEventId:d}=this.props;return o.createElement(V.a,{style:je.fill},o.createElement(Me.a,{style:je.viewportView},o.createElement(De.a,{accessibilityTitle:He,analytics:e,conversationIds:t,createLocalApiErrorHandler:a,customCellClick:this._dmDrawerOnClick,fetchInbox:r,fetchInboxHistory:n,fetchInboxIfNeeded:s,fetchStatus:i,fetchUpdates:c,isDrawer:!0,isRefreshing:l,renderEmptyDMInbox:this._renderEmptyDMInbox,renderStickyContent:this._renderPivot,updateLastSeenEventId:d,virtualScrollerCacheKey:"dmDrawerInbox"})))})),i()(this,"_renderEmptyDMInbox",(()=>o.createElement(Te.a,{buttonLink:"/messages/compose",buttonText:Pe,header:Ne,message:Le,onImpression:this._handleEmptyDMInboxImpression}))),i()(this,"_isExpanded",(()=>{const{visibility:e}=this.props;return e===P.a.EXPANDED})),i()(this,"_dmDrawerOnClick",((e,t)=>{const{popOutConversation:a}=this.props;a(t),e.preventDefault()})),i()(this,"_handleEmptyDMInboxImpression",(()=>{const{analytics:e}=this.props;e.scribe({component:"empty_message",action:"impression"})})),i()(this,"_handleRequestsPivotClick",(()=>{const{analytics:e}=this.props;e.scribe({element:"requests_pivot",action:"click"})})),i()(this,"_renderPivot",(()=>{const{allowUntrustedInbox:e}=this.props;return e?o.createElement(V.a,{style:je.requestPivotContainer},o.createElement(ke.a,{label:Ae,link:"/messages/requests",onPress:this._handleRequestsPivotClick,renderRightContent:this._renderPivotBadge,withBottomBorder:!1})):null})),i()(this,"_renderPivotBadge",(()=>{const{untrustedUnreadCount:e}=this.props;return e>0?o.createElement(G.a,{count:e,standalone:!0,truncatedCountFormatter:Fe,unreadCountLabel:Ue}):null}))}componentDidUpdate(){this._isExpanded()&&Object(k.a)()}render(){const{history:e,isUnread:t,isHeaderHighlighted:a,onDrawerOpen:r,triggerHeaderHighlight:n}=this.props,s=this._isExpanded();return o.createElement(o.Fragment,null,o.createElement(be,{hasNewMessages:t,history:e,isHighlighted:a,onDrawerOpen:r,triggerHighlight:n}),s&&this._renderExpandedInbox())}}const je=$.a.create((e=>({fill:{flex:1,alignSelf:"stretch"},requestPivotContainer:{backgroundColor:e.colors.cellBackground,borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor,zIndex:2},viewportView:{...$.a.absoluteFillObject,overflowY:"auto"}})));var Ve=Oe(Be),qe=a("YeIG"),Ge=a("A69o"),We="DMDrawer",Qe=a("TnY3"),$e=a("0FVZ"),ze=a("Oe3h");const Ke={isGlobal:!0,isSticky:!0},Xe={isGlobal:!0,isSticky:!1};class Ye extends o.PureComponent{constructor(...e){super(...e),i()(this,"state",{isHeaderHighlighted:!1,hasStartedInitialFetch:!1,unexpandedHeight:void 0}),i()(this,"_handleLayout",(e=>{const{nativeEvent:{layout:{height:t}}}=e,{unexpandedHeight:a}=this.state;this._isExpanded()||void 0!==a||this.setState({unexpandedHeight:t})})),i()(this,"_showDMDrawer",(()=>{const{conversations:e,visibility:t}=this.props,a=t===P.a.CLOSED;return!this._isHideDMDrawerPath()&&!Object(qe.a)(e)&&!a})),i()(this,"_isExpanded",(()=>{const{visibility:e}=this.props;return e===P.a.EXPANDED})),i()(this,"_triggerHeaderHighlight",(()=>{const{isHeaderHighlighted:e}=this.state;this._isExpanded()||e||this._headerHighlightTimeoutId||(this.setState({isHeaderHighlighted:!0}),this._headerHighlightTimeoutId=setTimeout((()=>{this.setState({isHeaderHighlighted:!1}),this._headerHighlightTimeoutId=void 0}),3e3))})),i()(this,"_handleDrawerOpen",(()=>{const{isHeaderHighlighted:e}=this.state;e&&(this.setState({isHeaderHighlighted:!1}),clearTimeout(this._headerHighlightTimeoutId),this._headerHighlightTimeoutId=void 0)})),i()(this,"_isOnOcfFlow",(()=>{const{location:e}=this.props;return e.pathname.startsWith("/i/flow")})),i()(this,"_isOnBirdwatchPage",(()=>{const{location:e}=this.props;return e.pathname.startsWith("/i/birdwatch")})),i()(this,"_isHideDMDrawerPath",(()=>this._isOnOcfFlow()||this._isOnBirdwatchPage()))}componentWillUnmount(){clearTimeout(this._headerHighlightTimeoutId)}componentDidUpdate(){this._loadInboxDataIfNeeded()}componentDidMount(){this._loadInboxDataIfNeeded()}render(){const{history:e,location:t,perspective:a,poppedOutConversationId:r,width:s}=this.props,{isHeaderHighlighted:i,unexpandedHeight:c}=this.state,l=this._isExpanded();return this._showDMDrawer()?o.createElement($e.a.Drawer,null,o.createElement(ze.a,{id:"DMDrawer"},((d,h)=>o.createElement(m.a.Provider,{value:{isDrawer:!0}},o.createElement(V.a,n()({ref:d()},h({style:[Ze.root,{width:s}],testID:We})),o.createElement(V.a,{onLayout:c?void 0:this._handleLayout,style:[Ze.expandable,{height:c,maxHeight:c},l&&Ze.expanded]},r?o.createElement(Ge.a.Provider,{value:Xe},o.createElement(Se,{conversationId:r,history:e,isHeaderHighlighted:i,location:t,onDrawerOpen:this._handleDrawerOpen,perspective:a,triggerHeaderHighlight:this._triggerHeaderHighlight})):o.createElement(Ge.a.Provider,{value:Ke},o.createElement(Ve,{history:e,isHeaderHighlighted:i,onDrawerOpen:this._handleDrawerOpen,triggerHeaderHighlight:this._triggerHeaderHighlight})))))))):null}_loadInboxDataIfNeeded(){const{fetchInboxIfNeeded:e,createLocalApiErrorHandler:t,loadDrawerVisibilityFromPersistence:a}=this.props,{hasStartedInitialFetch:r}=this.state;this._isHideDMDrawerPath()||r||(a(),e().catch(t()),this.setState({hasStartedInitialFetch:!0}))}}i()(Ye,"defaultProps",{width:c.a.dmDrawerWidth.max});const Ze=$.a.create((e=>({root:{alignSelf:"flex-end",backgroundColor:e.colors.navigationBackground,borderTopLeftRadius:e.borderRadii.xLarge,borderTopRightRadius:e.borderRadii.xLarge,boxShadow:e.boxShadows.medium,marginRight:e.spaces.space20,minWidth:c.a.dmDrawerWidth.min,maxWidth:c.a.dmDrawerWidth.max},expandable:{transition:"all 0.3s ease"},expanded:{maxHeight:c.a.dmDrawerHeight.expanded,height:"80vh"}}))),Je=p(Ye);t.default=Object(Qe.a)(Je)},"qS4/":function(e,t,a){"use strict";var r=a("KEM+"),n=a.n(r),s=(a("kYxP"),a("ERkP")),i=a("BUB3"),o=a("v6aA"),c=a("rxPX"),l=a("xZGM");var d=Object(c.a)().propsFromState((()=>({shouldShowPrompt:(e,t)=>Object(l.d)(e,l.a)}))).propsFromActions((()=>({addFlag:l.b}))).withAnalytics({component:"dm_education_flags_prompt"}),h=a("fs1G"),u=a("t62R"),p=a("feu+"),m=a("3XMw"),b=a.n(m);const g=b.a.fd6150fc,_=s.createElement(b.a.I18NFormatMessage,{$i18n:"iac7f92a"},s.createElement(u.c,{link:"/privacy"},b.a.d42d239f)),E=b.a.j24c37b2;var y=d((e=>{const{analytics:t,shouldShowPrompt:a,addFlag:r}=e,{featureSwitches:n}=s.useContext(o.a);if(!(a&&n.isTrue("dm_education_flags_prompt")&&n.isTrue("responsive_web_education_flags_on_server")))return!1;return t.scribeAction("impression"),s.createElement(p.a,{actionLabel:E,headline:g,headlineAlign:"left",onAction:()=>{t.scribeAction("click"),r(l.a)},onClose:h.a,subtext:_,subtextAlign:"left",withCloseButton:!1})})),v=a("MMRb"),f=(a("MvUL"),a("EbOo")),I=a("1YZw"),C=a("0KEI"),S=a("hqKg"),x=a("AQOc"),w=a("G6rE"),R=a("oEGd");const O=(e,t)=>t.conversationId,D=Object(S.createSelector)(O,((e,t)=>v.selectConversation(e,O(0,t))),v.selectEntries,w.e.selectAll,((e,t)=>!v.selectConversationIsRead(e,O(0,t))),((e,t)=>{const a=O(0,t);return Object(v.selectInboxTypeByConversation)(e,a)}),((e,t,a,r,n,s)=>({conversation:t&&Object(x.a)(t.data,a,r),conversationId:e,unread:n,inboxType:s}))),M={addRecentSearch:v.addRecentSearches,addToast:I.b,block:w.e.block,createLocalApiErrorHandler:Object(C.d)("DIRECT_MESSAGES_INBOX_ITEM"),leaveConversation:v.leaveConversation,muteDMUser:v.muteDMUser,unmuteDMUser:v.unmuteDMUser,unblock:w.e.unblock};var T=Object(R.g)(D,M),k=a("aA19"),H=a("OhSZ"),N=a("g54k");const L=Object(S.createSelector)(w.e.selectAll,((e,t)=>t.entry),N.b);var P=Object(R.c)(L),A=a("zQEV");var U=P((({entry:e,entryType:t,perspective:a,users:r})=>{const n=Object(A.a)(e,t,a,r);return s.createElement(u.c,{color:"gray700"},n)}));const F=Object(S.createSelector)(((e,t)=>w.e.select(e,t.senderId)),((e,t)=>t.recipientId?w.e.select(e,t.recipientId):void 0),((e,t)=>({user:e,recipient:t})));var B=Object(R.c)(F),j=a("X/yg"),V=a("cTG8");const q=e=>s.createElement(b.a.I18NFormatMessage,{$i18n:"b3a2b11c"},s.createElement(u.c,null,e)),G=b.a.dedfd265;const W=b.a.a876e58b,Q=b.a.bf584cd1,$=b.a.a9cc8cfd,z=b.a.e20b65b0,K=b.a.e5bfe07d,X=b.a.b1a614fe;var Y=B((({entry:e,perspective:t,isGroupDM:a,user:r={},recipient:n={}})=>{const{featureSwitches:i}=s.useContext(o.a),c=e&&e.message_data;if(!c)return null;const{attachment:l}=c,d=l&&!!(l.video||l.photo||l.animated_gif||l.tweet||l.fleet||l.sticker||l.card),h=t===r.id_str,p=!(!d||!h)||!(!a||h),m=r.name,g=n.name;let _=[p&&s.createElement(u.c,{key:"senderName"},q(m)," "),c&&c.text&&s.createElement(V.a,{displayTextRange:[0,c.text.length],entities:c.entities,key:"message",text:c.text,withMediaLinks:!0})];return l&&(l.tweet?_=p?((e,t)=>e?s.createElement(u.c,null,b.a.d5b762c8):s.createElement(b.a.I18NFormatMessage,{$i18n:"dfd2b3b9"},s.createElement(u.c,null,t)))(h,m):X:l.fleet?_=((e,t,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"i005f1fd"},s.createElement(u.c,null,t),s.createElement(u.c,null,a||"")):s.createElement(b.a.I18NFormatMessage,{$i18n:"b35cee40"},s.createElement(u.c,null,a||"")))(h,g,c.text):l.video?_=Object(j.h)(l,i)?p?function(e,t){return e?s.createElement(u.c,null,b.a.h7033cac):s.createElement(b.a.I18NFormatMessage,{$i18n:"be5a9616"},s.createElement(u.c,null,t))}(h,m):G:p?((e,t)=>e?s.createElement(u.c,null,b.a.j7d81019):s.createElement(b.a.I18NFormatMessage,{$i18n:"eee2f120"},s.createElement(u.c,null,t)))(h,m):W:l.photo?_=p?((e,t)=>e?s.createElement(u.c,null,b.a.f80629ba):s.createElement(b.a.I18NFormatMessage,{$i18n:"c1e1f848"},s.createElement(u.c,null,t)))(h,m):Q:l.animated_gif?_=p?((e,t)=>e?s.createElement(u.c,null,b.a.eb3d722e):s.createElement(b.a.I18NFormatMessage,{$i18n:"dc4b75a1"},s.createElement(u.c,null,t)))(h,m):$:l.sticker?_=p?((e,t)=>e?s.createElement(u.c,null,b.a.d30c2d4f):s.createElement(b.a.I18NFormatMessage,{$i18n:"c7e2464e"},s.createElement(u.c,null,t)))(h,m):z:l.card&&(_=p?((e,t)=>e?s.createElement(u.c,null,b.a.db53c017):s.createElement(b.a.I18NFormatMessage,{$i18n:"hcbbbb34"},s.createElement(u.c,null,t)))(h,m):K)),s.createElement(u.c,{color:"gray700",numberOfLines:1},_)})),Z=a("uKEd");const J=(e,t)=>t.senderId?w.e.select(e,t.senderId):void 0,ee=(e,t)=>Object(Z.n)(e,t.reactionEntry.message_id),te=(e,t)=>{const a=ee(e,t);return a&&a.message_data&&w.e.select(e,a.message_data.sender_id)};var ae=Object(R.e)((()=>Object(S.createSelector)(J,ee,te,((e,t,a)=>({reactedMessageEntry:t,reactingUser:e,messageUser:a})))),{}),re=a("33Kz");var ne=ae((({isGroupDM:e,messageUser:t,perspective:a,reactionEntry:r,reactedMessageEntry:n,reactingUser:i})=>{const{featureSwitches:c}=s.useContext(o.a),l=n&&n.message_data,d=l&&l.attachment,h=l&&l.text,p=t&&t.screen_name,m=a===(i&&i.id_str),g=i&&i.name,_=Object(re.b)(r.reaction_key||"",c);let E;return E=d&&d.tweet?e?((e,t,a,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"c4202784"},s.createElement(u.c,null,a),s.createElement(u.c,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"b493a890"},s.createElement(u.c,null,t),s.createElement(u.c,null,a),s.createElement(u.c,null,r)))(m,g,p,_):((e,t,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"ca684bf5"},s.createElement(u.c,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"h5797be5"},s.createElement(u.c,null,t),s.createElement(u.c,null,a)))(m,g,_):d&&d.video?e?((e,t,a,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"d1f8bdd9"},s.createElement(u.c,null,a),s.createElement(u.c,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"d764af97"},s.createElement(u.c,null,t),s.createElement(u.c,null,a),s.createElement(u.c,null,r)))(m,g,p,_):((e,t,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"ab1cdfe2"},s.createElement(u.c,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"f0cf1699"},s.createElement(u.c,null,t),s.createElement(u.c,null,a)))(m,g,_):d&&d.photo?e?((e,t,a,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"hec0fd4d"},s.createElement(u.c,null,a),s.createElement(u.c,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"j55320de"},s.createElement(u.c,null,t),s.createElement(u.c,null,a),s.createElement(u.c,null,r)))(m,g,p,_):((e,t,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"jf27606a"},s.createElement(u.c,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"cd110359"},s.createElement(u.c,null,t),s.createElement(u.c,null,a)))(m,g,_):d&&d.animated_gif?e?((e,t,a,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"e70dcc35"},s.createElement(u.c,null,a),s.createElement(u.c,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"g1bf440b"},s.createElement(u.c,null,t),s.createElement(u.c,null,a),s.createElement(u.c,null,r)))(m,g,p,_):((e,t,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"b2da1bf8"},s.createElement(u.c,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"g84c0421"},s.createElement(u.c,null,t),s.createElement(u.c,null,a)))(m,g,_):d&&d.card?e?((e,t,a,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"cd2e7c18"},s.createElement(u.c,null,a),s.createElement(u.c,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"aee9e7fa"},s.createElement(u.c,null,t),s.createElement(u.c,null,a),s.createElement(u.c,null,r)))(m,g,p,_):((e,t,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"f9fb1cf6"},s.createElement(u.c,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"f2bf910e"},s.createElement(u.c,null,t),s.createElement(u.c,null,a)))(m,g,_):h?e?((e,t,a,r,n)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"i6cec545"},s.createElement(u.c,null,r),s.createElement(u.c,null,a),s.createElement(u.c,null,n)):s.createElement(b.a.I18NFormatMessage,{$i18n:"d6998baa"},s.createElement(u.c,null,t),s.createElement(u.c,null,r),s.createElement(u.c,null,a),s.createElement(u.c,null,n)))(m,g,_,p,h):((e,t,a,r)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"cec676f3"},s.createElement(u.c,null,a),s.createElement(u.c,null,r)):s.createElement(b.a.I18NFormatMessage,{$i18n:"a2706f9a"},s.createElement(u.c,null,t),s.createElement(u.c,null,a),s.createElement(u.c,null,r)))(m,g,_,h):((e,t,a)=>e?s.createElement(b.a.I18NFormatMessage,{$i18n:"d6b15bbf"},s.createElement(u.c,null,a)):s.createElement(b.a.I18NFormatMessage,{$i18n:"ac0d4bc7"},s.createElement(u.c,null,t),s.createElement(u.c,null,a)))(m,g,_),s.createElement(u.c,{color:"gray700",numberOfLines:1},E)})),se=a("H4nC"),ie=a("b9JY");const oe=b.a.fb3ccb55;var ce=({conversationType:e,entry:t,perspective:a})=>{if(t.marked_as_spam)return s.createElement(u.c,{color:"gray700",numberOfLines:1},oe);if(Object(ie.b)(t)){const{message_data:{sender_id:r,recipient_id:n}={}}=t;return s.createElement(Y,{entry:t,isGroupDM:e===v.CONVERSATION_TYPE.GROUP,perspective:a,recipientId:n,senderId:r})}return Object(ie.c)(t)?s.createElement(ne,{isGroupDM:e===v.CONVERSATION_TYPE.GROUP,perspective:a,reactionEntry:t,senderId:t.sender_id}):Object(ie.a)(t)?s.createElement(U,{entry:t,entryType:t.type,perspective:a}):Object(ie.d)(t)?s.createElement(se.a,{entry:t,isCompact:!0}):null},le=a("3wZR"),de=a("XnpN"),he=a("xPna"),ue=a("b2lu"),pe="conversation",me=a("u0B7"),be=a("MWbm"),ge=a("Irs7"),_e=a("0PHd"),Ee=a("yrzJ"),ye=a("Xrkv"),ve=a("/yvb"),fe=a("eb3s"),Ie=a("lHOd"),Ce=a("efqG"),Se=a("GBcw"),xe=a("htQn"),we=a("5mJL"),Re=a("rHpw"),Oe=a("vMjK"),De=a("aWyx"),Me=a("BcsE"),Te=a("Myq3"),ke=a("hiGS"),He=a("5oT/"),Ne=a("Lsrn"),Le=a("k/Ka");const Pe=(e={})=>Object(Le.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[Ne.a.root,e.style],viewBox:"0 0 24 24"},s.createElement("g",null,s.createElement("path",{d:"M22.238 2.257c-.293-.293-.768-.293-1.06 0L2.52 20.917c-.293.292-.293.767 0 1.06.146.146.338.22.53.22s.384-.073.53-.22l18.658-18.66c.293-.293.293-.767 0-1.06zM2.986 17.82c.155 0 .312-.048.446-.148.112-.083 2.752-2.104 2.708-7.248-.02-2.16.643-3.98 1.913-5.266 1.093-1.107 2.577-1.72 4.18-1.727 1.325.006 2.562.42 3.578 1.195.137.104.297.153.455.153.227 0 .45-.102.598-.295.25-.33.188-.8-.142-1.052-1.278-.975-2.828-1.493-4.483-1.5h-.003c-2.008.008-3.87.78-5.248 2.173-1.536 1.551-2.368 3.8-2.348 6.332.037 4.33-2.02 5.967-2.103 6.03-.332.247-.4.718-.154 1.05.147.2.374.303.603.303zm16.844-7.382c.002-.246-.003-.487-.017-.723-.024-.414-.387-.74-.792-.706-.413.023-.728.378-.705.79.012.205.017.413.015.624-.024 2.868.785 4.765 1.526 5.896h-8.314c-.414 0-.75.336-.75.75s.336.75.75.75h3.522c-.1 1.48-1.323 2.66-2.828 2.66-1.003 0-1.913-.514-2.436-1.372-.214-.354-.675-.467-1.03-.25-.354.214-.467.675-.25 1.03.795 1.31 2.185 2.09 3.716 2.09 2.332 0 4.227-1.85 4.328-4.158h4.922c.32 0 .604-.206.707-.51.104-.305 0-.643-.255-.84-.087-.066-2.145-1.7-2.108-6.032z"})));Pe.metadata={width:24,height:24};var Ae=Pe;const Ue=b.a.gde6b424,Fe=b.a.e308019b,Be=b.a.gf5e9ea6,je=b.a.gdf4b79f,Ve=b.a.bbf83d83,qe=b.a.d96cf7cd,Ge=b.a.d88d0790,We={component:"low_quality_timeline"},Qe=({children:e})=>s.createElement(be.a,{style:ze.socialProofContainer},e);class $e extends s.Component{constructor(...e){super(...e),n()(this,"state",{showConfirmation:!1}),n()(this,"_renderConvoLabel",(({convo_label:e})=>{if(null==e||!e.text)return null;const t=Object(le.b)(e.icon);return s.createElement(u.c,{color:"gray700",size:"small"},t?s.createElement(t,{style:ze.convoLabelIcon}):null,e.text)})),n()(this,"_renderSocialProof",(({social_proof:e})=>{if(!e||0===e.length)return null;const t=e[0];switch(t.proof_type){case De.d.MUTUAL_FRIENDS:{if(0===t.total)return null;const e=t.users.map((({profile_image_url_https:e})=>e)),a=t.users.map((({name:e})=>e));return s.createElement(Qe,null,s.createElement(_e.a,{displayFacepileInline:!0,knownFollowersAvatarUrls:e,knownFollowersCount:t.total,knownFollowersNames:a}))}default:return null}})),n()(this,"_renderSearchConversationPreview",(()=>{const{conversation:e,perspective:t,searchQuery:a}=this.props,r=e?Object(de.a)(e,t):[],n=[],i=(e,t)=>e.localeCompare(t),o=r.map((({user:e})=>e)).filter((e=>{var r;const s=null==(r=e.name)?void 0:r.toLowerCase().includes(a);return e.id_str!==t&&(s&&n.push(e.name),!s)})).map((e=>e.name)).sort(i),c=n.sort(i).concat(o);if(e){if(e.type===v.CONVERSATION_TYPE.ONE_TO_ONE){const[e]=r.map((({user:e})=>e));return s.createElement(Ee.a,{color:"gray700",screenName:e.screen_name})}{const e=!0,t=Object(ye.a)(c,e);return s.createElement(u.c,{color:"gray700",numberOfLines:2},t)}}})),n()(this,"_renderTrashcan",(()=>{const{conversationId:e}=this.props;return s.createElement(s.Fragment,null,s.createElement(ve.a,{accessibilityLabel:qe,borderColor:"transparent",icon:s.createElement(ke.a,{style:ze.trashcanIcon}),onPress:this._handleShowConfirmation,type:"destructiveText"}),this.state.showConfirmation?s.createElement(fe.a,{confirmButtonLabel:qe,confirmButtonType:"destructive",headline:je,onCancel:this._handleHideConfirmation,onConfirm:this._deleteConversation(e),text:Ve}):null)})),n()(this,"_renderX",(()=>{const{conversation:e,conversationId:t}=this.props,{loggedInUserId:a}=this.context,r=this.context.featureSwitches.isTrue("dm_conversations_muting_enabled"),n=Object(j.f)(e,a),i=(null==e?void 0:e.type)===v.CONVERSATION_TYPE.GROUP;return s.createElement(Ie.a.Consumer,null,(a=>s.createElement(Ce.a,{renderContent:(o,c)=>s.createElement(ue.a,{dismiss:o,flatBorders:"sheet"===c,isGroup:i,isMuted:!(null==e||!e.muted),onBlockClick:this._blockUser(n.idStr),onDeleteClick:this._deleteConversation(t),onMuteDMUserClick:this._handleMuteDMUserClick(a),onReportClick:this._handleReportMenuItemClick(a),onUnmuteDMUserClick:this._handleUnmuteDMUserClick(a),requestorScreenName:n.screenName,showBlock:!i,showCancel:"sheet"===c,showDelete:!0,showMute:r&&!i})},s.createElement(ve.a,{accessibilityLabel:Ge,borderColor:"transparent",icon:s.createElement(He.a,{style:ze.xIcon}),onPress:this._handleXPress,style:ze.xButton,type:"text"}))))})),n()(this,"_handleXPress",(e=>{e.preventDefault()})),n()(this,"_handleReportMenuItemClick",(e=>()=>{const{analytics:t,conversationId:a,inboxType:r}=this.props;if(a){t.scribeAction("report");const n=Object(j.d)(a,window.location.pathname,t.contextualScribeNamespace,r);e.push(n)}})),n()(this,"_handleMuteDMUserClick",(e=>()=>{const{addToast:t,analytics:a,conversation:r,conversationId:n,createLocalApiErrorHandler:s,inboxType:i,muteDMUser:o}=this.props,{loggedInUserId:c}=this.context,{idStr:l,name:d}=Object(j.f)(r,c);o(l,n).then((()=>{t({action:{label:Be,onAction:this._handleUnmuteDMUserClick(e)},text:Ue({name:d})}),i!==he.b.tertiary&&e.replace("/messages/requests")}),s()),a.scribeAction("mute_user")})),n()(this,"_handleUnmuteDMUserClick",(e=>()=>{const{addToast:t,analytics:a,conversation:r,conversationId:n,createLocalApiErrorHandler:s,unmuteDMUser:i}=this.props,{loggedInUserId:o}=this.context,{idStr:c,name:l}=Object(j.f)(r,o);n&&(i(c,n).then((()=>{t({action:{label:Be,onAction:this._handleMuteDMUserClick(e)},text:Fe({name:l})})}),s()),a.scribeAction("unmute_user"))})),n()(this,"_renderTimestamp",(()=>{const{conversation:e}=this.props;return s.createElement(s.Fragment,null,s.createElement(be.a,null,e?s.createElement(Se.a,{timestamp:Number(e.sort_timestamp)}):null,null!=e&&e.notifications_disabled?s.createElement(Ae,{style:ze.notificationsDisabledIcon}):null))})),n()(this,"_deleteConversation",(e=>()=>{const{analytics:t,conversation:a,createLocalApiErrorHandler:r,inboxType:n,leaveConversation:s}=this.props,{history:i}=this.context,o=a&&a.type===v.CONVERSATION_TYPE.GROUP?"leave_group":"delete_thread";this._handleHideConfirmation(),t.scribe({element:"thread",action:o}),s({conversationId:e}).catch(r({showToast:!0})),i.replace(Object(j.c)(n))})),n()(this,"_blockUser",(e=>()=>{const{analytics:t,addToast:a,block:r,createLocalApiErrorHandler:n}=this.props;r(e).then((()=>{a({action:{label:Oe.c,onAction:this._createUnblockUserHandler(e)},text:Oe.a})}),n(f.a)),t.scribeAction("block")})),n()(this,"_createUnblockUserHandler",(e=>()=>{const{analytics:t,createLocalApiErrorHandler:a,unblock:r}=this.props;r(e).catch(a(me.a)),t.scribeAction("unblock")})),n()(this,"_handleHideConfirmation",(()=>{this.setState({showConfirmation:!1})})),n()(this,"_handleOnClick",(e=>{const{addRecentSearch:t,analytics:a,conversationId:r,onClick:n,conversation:s,searchIndex:i,searchQuery:o}=this.props,c=this.context.featureSwitches.isTrue("responsive_web_dm_server_side_search"),l=null!=s&&s.participants?Object.keys(s.participants).length:0,d=(null==s?void 0:s.type)===v.CONVERSATION_TYPE.GROUP;o&&c&&(a.scribe({component:"search",element:"conversation",action:"click",data:{conversation_id:r,conversation_participant_count:l,conversation_type:d?j.a.GROUP:j.a.ONE_TO_ONE,position:Object(Me.a)(i)?i+1:0}}),a.scribe({component:"recent_search",action:"add"}),t(o)),n(e,r,!(null==s||!s.muted),s)})),n()(this,"_handleShowConfirmation",(e=>{const{analytics:t}=this.props;e.stopPropagation(),t.scribe({...We,element:"accessory_trashcan",action:"click"}),this.setState({showConfirmation:!0})}))}shouldComponentUpdate(e,t){const a=this.props.conversation,r=null==a?void 0:a.conversation_id,n=null==a?void 0:a.last_read_event_id,s=null==a?void 0:a.sort_event_id,i=null==a?void 0:a.max_entry_id,o=null==a?void 0:a.convo_label,c=e.conversation,l=null==c?void 0:c.conversation_id,d=null==c?void 0:c.last_read_event_id,h=null==c?void 0:c.sort_event_id,u=null==c?void 0:c.max_entry_id,p=null==c?void 0:c.convo_label,{filter:m,isActive:b}=this.props,{filter:g,isActive:_}=e,{showConfirmation:E}=this.state,{showConfirmation:y}=t;return r!==l||n!==d||s!==h||i!==u||b!==_||E!==y||m!==g||o!==p}render(){const{conversation:e,searchQuery:t,filter:a,isActive:r,isSecondaryInbox:n,isTertiaryInbox:i,perspective:o,unread:c,link:l}=this.props,d=(null==e?void 0:e.entries)||[],h=Object(Te.a)(d,(e=>![De.b.MESSAGE_DELETE,De.b.REACTION_DELETE,De.b.MESSAGE_MARK_AS_SPAM,De.b.MESSAGE_MARK_AS_NOT_SPAM,De.b.CONVO_METADATA_UPDATE].includes(e.type))),u=[ze.root,ze.bottomBorder,c&&ze.unread],p=this.context.featureSwitches.isTrue("responsive_web_dm_server_side_search"),m=this.context.featureSwitches.isTrue("dm_conversations_requests_inbox_actions_button_enabled"),b=e&&a&&a(e);if(!e||!b&&!p)return null;const g=!!e.convo_label,_=!e.trusted&&!g;return!e||!b&&!p||!t&&e.isSearchResultOnly?null:s.createElement(xe.a,{accessibilityRole:"tab",accessibilityState:{selected:r},link:{pathname:l,anchorless:!0},onPress:this._handleOnClick,style:u,testID:pe},s.createElement(we.a,{avatarCell:s.createElement(k.a,{conversation:e,perspective:o})},s.createElement(be.a,{style:ze.bodyColumn},s.createElement(be.a,{style:ze.titleContainer},s.createElement(H.b,{conversation:e,isSearchTitle:!!t&&p,perspective:o,withScreenName:!t}),s.createElement(be.a,{style:ze.snippet},!h||p&&t?p&&t?this._renderSearchConversationPreview():null:s.createElement(ce,{conversationType:e.type,entry:h,perspective:o})),g?this._renderConvoLabel(e):null,_?this._renderSocialProof(e):null),m&&(n||i)?this._renderX():i?this._renderTrashcan():this._renderTimestamp())))}}n()($e,"contextType",o.a),n()($e,"defaultProps",{searchQuery:"",isActive:!1,isSecondaryInbox:!1,isTertiaryInbox:!1,filter:e=>!0});const ze=Re.a.create((e=>({root:{backgroundColor:e.colors.cellBackground,paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.spaces.space16,width:"100%"},bottomBorder:{borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor},bodyColumn:{flexDirection:"row"},titleContainer:{flex:1},notificationsDisabledIcon:{alignSelf:"flex-end",color:e.colors.gray700,paddingTop:e.spaces.space4},xButton:{alignSelf:"center",marginRight:`calc(-1 * ${e.spaces.space4})`},xIcon:{color:e.colors.red500},trashcanIcon:{color:e.colors.gray700},snippet:{maxHeight:e.spaces.space40,overflow:"hidden"},unread:{backgroundColor:e.colors.unreadCellBackground},socialProofContainer:{marginTop:e.spaces.space4},convoLabelIcon:{marginRight:e.spaces.space4}})));var Ke=Object(ge.a)(T($e),{page:"messages",section:"inbox"}),Xe=(a("Qavd"),a("kGix"));const Ye=v.selectRecentSearches,Ze=(e,t)=>null!=e&&e.length?t.filter((t=>e.indexOf(t)>-1)):e,Je=Object(S.createSelector)(Ye,((e,t)=>t.query?v.selectSearchFetchStatus(e,t.query):Xe.a.LOADED),((e,t)=>t.query?v.selectSearchConversations(e,t.query):[]),((e,t)=>t.conversationIds||[]),((e,t,a,r)=>({recentSearches:e,searchConversationIds:Ze(a,r),searchFetchStatus:t,conversationIds:r}))),et={addRecentSearch:v.addRecentSearches,createLocalApiErrorHandler:Object(C.d)("DIRECT_MESSAGES_SEARCH"),search:v.searchConversations,clearRecentSearch:v.clearRecentSearch,clearRecentSearches:v.clearRecentSearches};var tt=Object(R.g)(Je,et),at=a("VY6S"),rt=a("s14A");const nt=b.a.b08821f3,st=b.a.e047b8fa,it=Re.a.create((e=>({backButton:{marginRight:e.spaces.space4},iconContainer:{alignItems:"center",flexDirection:"row"},icon:{color:e.colors.text,marginRight:e.spaces.space12,fontSize:e.fontSizes.body,marginVertical:e.spaces.space8},header:{backgroundColor:e.colors.cellBackground,paddingLeft:e.spaces.space16,paddingVertical:e.spaces.space4,alignItems:"center",flexDirection:"row",justifyContent:"space-between",borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor}})));var ot=e=>{const t=Object(ge.b)(),{clearRecentSearches:a,headerText:r,icon:n,withClearButton:i}=e;s.useEffect((()=>{t.scribe({component:"recent_search",action:"impression"})}),[t]);return s.createElement(be.a,{style:it.header},s.createElement(be.a,{style:it.iconContainer},(()=>{const e=n;return e?s.createElement(e,{style:it.icon}):null})(),s.createElement(u.c,{size:"large",weight:"heavy"},r)),i?s.createElement(ve.a,{accessibilityLabel:nt,onPress:a,pullRight:!0,style:it.backButton,type:"invertedPrimary"},st):null)},ct=a("j7Bv"),lt=a("VwDm"),dt=a("hOZg");const ht=b.a.dbd5d40f;class ut extends s.PureComponent{render(){const{clearRecentSearch:e,handleRecentSearchClick:t,recentSearch:a}=this.props,r=s.createElement(ct.a,{Icon:lt.a,color:"neutral",size:"xLarge",style:pt.searchIcon}),n=[pt.listItemView,pt.bottomBorder];return s.createElement(xe.a,{onPress:t,style:n},s.createElement(be.a,null,s.createElement(we.a,{avatarCell:r,avatarSize:"xLarge",cellStyle:pt.avatarColumn},s.createElement(be.a,{style:pt.container},s.createElement(u.c,{numberOfLines:1},a),s.createElement(ve.a,{accessibilityLabel:ht,borderColor:"transparent",icon:s.createElement(dt.a,null),onPress:e,type:"text"})))))}}const pt=Re.a.create((e=>({container:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},searchIcon:{marginRight:e.spaces.space12,padding:e.spaces.space4},avatarColumn:{flexGrow:1,minWidth:"32px"},bottomBorder:{borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor},listItemView:{backgroundColor:e.colors.cellBackground,paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.spaces.space12,width:"100%"}})));var mt=ut,bt=a("v//M"),gt=a("SrCX"),_t=a("VPAj");var Et={...a("IRWI").a,initialScrollHeadroom:Object(_t.a)(0),scrollHeadroom:Object(_t.a)(0),pinToTopWhenAtTop:!0},yt=a("TEoO"),vt=a("IG4P"),ft=a("RJrc"),It=a("TnY3"),Ct=a("FIs5"),St=a("0yYu"),xt=a("cm6r"),wt=a("k/OQ"),Rt=a("6ZHn"),Ot=a("lBmi"),Dt=a("95Se");const Mt=e=>e,Tt=b.a.b08821f3,kt=b.a.a66ac766,Ht=b.a.fe61929d,Nt=b.a.b9dae4f4,Lt=b.a.e7fb2027,Pt=b.a.b92a21d8,At=b.a.jdc67c42,Ut=b.a.f08940ab,Ft=b.a.gaae1fd5,Bt=b.a.f8321d82,jt=b.a.g2fd3205,Vt=b.a.c94ac69d,qt=b.a.fb3c8e74;class Gt extends s.Component{constructor(...e){super(...e),n()(this,"state",{debouncedQuery:"",isLoadingMore:!1,isRefreshing:!1}),n()(this,"_modularSearchEnabled",this.context.featureSwitches.isTrue("dm_inbox_search_modular_results_enabled")),n()(this,"_setInputRef",(e=>{this._textInputRef=e})),n()(this,"_renderEmptyDMSearchInbox",(()=>{const{analytics:e,query:t}=this.props;return this.state.debouncedQuery&&t?(e.scribe({component:"search",element:"results",action:"empty"}),s.createElement(Ct.a,{buttonLink:"/messages/compose",buttonText:Ut,header:Pt({query:this.state.debouncedQuery}),message:At,onButtonPress:this._handleComposeButtonPress})):s.createElement(Ct.a,{message:Ft})})),n()(this,"_renderRecentSearches",(()=>{const{analytics:e,recentSearches:t,query:a}=this.props;return t.length&&!a?s.createElement(s.Fragment,null,s.createElement(ot,{analytics:e,clearRecentSearches:this._clearRecentSearches,headerText:qt,withClearButton:!0}),t.map((e=>s.createElement(mt,{clearRecentSearch:t=>this._handleClearRecentSearch(t,e),handleRecentSearchClick:()=>this._handleRecentSearchClick(e),key:e,recentSearch:e})))):this._renderEmptyDMSearchInbox()})),n()(this,"_renderTabContent",(()=>{const{location:e}=this.props,{tab:t}=(null==e?void 0:e.state)||{};return t&&t!==Bt?this._renderEmptyDMSearchInbox():s.createElement(s.Fragment,null,this._renderDMSearchHeader({icon:Rt.a,headerText:jt}),s.createElement(St.a,null),this._renderDMSearchHeader({icon:Ot.a,headerText:Vt}))})),n()(this,"_renderModularSearchResults",(()=>{const{query:e}=this.props;return e?this._renderTabContent():this._renderRecentSearches()})),n()(this,"_renderDMSearchHeader",(({icon:e,headerText:t})=>s.createElement(ot,{clearRecentSearches:this._clearRecentSearches,headerText:t,icon:e}))),n()(this,"_renderSearchResults",(()=>{const{accessibilityTitle:e,searchConversationIds:t,renderInboxItem:a}=this.props,{debouncedQuery:r,isRefreshing:n}=this.state;return s.createElement(rt.a,null,s.createElement(vt.a,{isRefreshing:n,onRefresh:this._handlePullToRefresh},s.createElement(yt.a,{accessibilityRole:"tablist",accessibilityTitle:e,anchoring:Et,assumedItemHeight:100,cacheKey:"dmSearchInbox",footer:this._renderFooter(),identityFunction:Mt,items:t,noItemsRenderer:this._renderRecentSearches,onNearEnd:this._handleNearEnd,onScrollEnd:this._handleScrollEnd,renderer:a(r,t),withHeadroom:!1})))})),n()(this,"_renderFooter",(()=>this.state.isLoadingMore?s.createElement(ft.a,null):s.createElement(be.a,{style:Wt.footerContainer},s.createElement(u.c,{align:"center",size:"normal",weight:"bold"},Lt),s.createElement(xt.a,{interactiveStyles:null},s.createElement(u.c,{align:"center",color:"primary",onPress:this._handleFooterClick,size:"small",withInteractiveStyling:!0},Nt))))),n()(this,"_clearRecentSearches",(()=>{const{analytics:e,clearRecentSearches:t}=this.props;e.scribe({component:"recent_search",action:"clear"}),t()})),n()(this,"_handleComposeButtonPress",(()=>{const{analytics:e}=this.props;e.scribe({component:"search",element:"empty_results",action:"compose"})})),n()(this,"_handleFooterClick",(()=>{var e,t,a;this._textInputRef&&this._textInputRef.focus(),null==(e=this._textInputRef)||null==(t=e._textInput)||null==(a=t._textInputNode)||a.select()})),n()(this,"_handleRefetchSearch",(()=>{const{analytics:e,createLocalApiErrorHandler:t,search:a}=this.props,{debouncedQuery:r}=this.state;a&&r&&(e.scribe({component:"search",element:"retry",action:"click"}),a({query:r.toLowerCase(),preserveResults:!1,fetchNextPage:!1}).catch(t()))})),n()(this,"_handlePullToRefresh",(()=>{const{createLocalApiErrorHandler:e,search:t}=this.props,{debouncedQuery:a}=this.state;this.setState({isRefreshing:!0}),t&&a&&t({query:a.toLowerCase(),preserveResults:!0,fetchNextPage:!1}).then((()=>this.setState({isRefreshing:!1}))).catch((t=>(this.setState({isRefreshing:!1}),e()(t))))})),n()(this,"_handleSearchChangeInner",(e=>{const{createLocalApiErrorHandler:t,search:a,onQueryChange:r}=this.props;r(e),this.setState({debouncedQuery:e}),e&&a({query:e,preserveResults:!1,fetchNextPage:!1}).catch(t())})),n()(this,"_handleSearchChangeDebounced",Object(at.a)(this._handleSearchChangeInner,200)),n()(this,"_handleSearchChange",(({currentTarget:{value:e}})=>{const{onQueryChange:t}=this.props;(e&&e.trim()||!e)&&(t(e),this._handleSearchChangeDebounced(e))})),n()(this,"_handleNearEnd",(()=>{const{analytics:e,search:t}=this.props,{debouncedQuery:a}=this.state;this.setState({isLoadingMore:!0}),a&&(e.scribe({component:"search",element:"results",action:"get_older"}),t({query:a,preserveResults:!1,fetchNextPage:!0}).finally((()=>this.setState({isLoadingMore:!1}))))})),n()(this,"_handleScrollEnd",(()=>{const{addRecentSearch:e,analytics:t,query:a}=this.props,{debouncedQuery:r}=this.state;r&&a&&(e(a),t.scribe({component:"recent_search",action:"add"}))})),n()(this,"_handleSearchClear",(()=>this._handleSearchChangeInner(""))),n()(this,"_handleHideRecentSearches",(()=>{const{hideRecentSearches:e}=this.props;e()})),n()(this,"_handleAddRecentSearch",(({currentTarget:{value:e}})=>{const{addRecentSearch:t,analytics:a}=this.props;e&&(t(e),a.scribe({component:"recent_search",action:"add"}),this._textInputRef&&this._textInputRef.blur())})),n()(this,"_handleRecentSearchClick",(e=>{const{analytics:t,onQueryChange:a}=this.props;a(e),t.scribe({component:"recent_search",action:"click"}),this._handleSearchChangeInner(e)})),n()(this,"_handleClearRecentSearch",((e,t)=>{const{analytics:a,clearRecentSearch:r}=this.props;e.stopPropagation(),e.preventDefault(),a.scribe({component:"recent_search",action:"clear"}),r(t)}))}componentDidMount(){this._textInputRef&&this._textInputRef.focus()}componentDidUpdate(e){const{analytics:t,recentSearches:a,query:r}=this.props;e.query||!r||a.includes(r)||t.scribe({component:"search",action:"began_typing"})}render(){const{location:e,searchFetchStatus:t,query:a}=this.props,r=!this._modularSearchEnabled||!a,n=[Wt.searchInput,r?Wt.searchInputBorder:void 0],{tab:i}=(null==e?void 0:e.state)||{},o=[Bt,jt,Vt].map((t=>({label:t,isActive:()=>i===t||!i&&t===Bt,to:{...e,state:{...e.state,tab:t}}})));return s.createElement(s.Fragment,null,s.createElement(be.a,{style:n},s.createElement(ve.a,{accessibilityLabel:Tt,icon:s.createElement(Dt.a,null),onPress:this._handleHideRecentSearches,pullLeft:!0,type:"text"}),s.createElement(gt.a,{Icon:lt.a,autoComplete:"off",onChange:this._handleSearchChange,onClear:this._handleSearchClear,onSubmitEditing:this._handleAddRecentSearch,placeholder:Ht,ref:this._setInputRef,value:a,withClearButton:!0})),this._modularSearchEnabled&&a?s.createElement(wt.a,{links:o}):null,s.createElement(bt.a,{accessibilityLabel:kt,fetchStatus:t,onRequestRetry:this._handleRefetchSearch,render:this._modularSearchEnabled?this._renderModularSearchResults:this._renderSearchResults}))}}n()(Gt,"contextType",o.a),n()(Gt,"defaultProps",{recentSearches:[],searchConversationIds:[],query:""});const Wt=Re.a.create((e=>({searchInput:{backgroundColor:e.colors.cellBackground,padding:e.spaces.space12,flexDirection:"row",alignItems:"center",zIndex:1},searchInputBorder:{borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small},footerContainer:{marginVertical:e.spaces.space32}})));var Qt=Object(It.a)(tt(Gt)),$t=a("dwig"),zt=a("QB0K"),Kt=a("Avzu"),Xt=a("FRNI");const Yt=b.a.dabdea6b,Zt=b.a.f325afc3;class Jt extends s.PureComponent{render(){return s.createElement(zt.a,{accessibilityLabel:Yt,href:"/messages/compose",icon:s.createElement(Kt.a,null),label:Yt,scribeComponent:"floating_dm_button",shortLabel:Zt,testID:Xt.a.message})}}var ea=Jt,ta=a("tI3i"),aa=a.n(ta),ra=a("883S"),na=a("yoO3"),sa=a("GSsg"),ia=a("2g+p"),oa=a("mw9i"),ca=a("+d3d");const la=e=>e,da=b.a.a66ac766,ha=b.a.fe61929d;class ua extends s.Component{constructor(e,t){super(e,t),n()(this,"state",{filterQuery:"",showRecentSearches:!1,searchQuery:""}),n()(this,"_render",(()=>{const{showRecentSearches:e}=this.state;return this._isServerSearchEnabled&&e?this._renderFocusedSearch():this._renderInbox()})),n()(this,"_renderFocusedSearch",(()=>{const{accessibilityTitle:e,analytics:t,conversationIds:a,renderStickyContent:r}=this.props,{searchQuery:n}=this.state;return s.createElement(s.Fragment,null,r?r():null,s.createElement(Qt,{accessibilityTitle:e,analytics:t,conversationIds:a,hideRecentSearches:this._hideRecentSearches,onQueryChange:this._handleQueryChange,query:n,renderInboxItem:this._renderInboxItem}))})),n()(this,"_renderInbox",(()=>{const{accessibilityTitle:e,conversationIds:t,footer:a,isDrawer:r,isRefreshing:n,renderEmptyDMInbox:i,renderStickyContent:o,virtualScrollerCacheKey:c}=this.props,l=s.createElement(s.Fragment,null,o?o():null,this._enableSearchInbox?s.createElement(be.a,{onClick:this._isServerSearchEnabled?this._handleSearchClick:void 0,style:pa.searchInput},s.createElement(gt.a,{Icon:lt.a,autoComplete:"off",onChange:this._handleSearchChange,onClear:this._handleSearchClear,onFocus:this._handleSearchFocus,placeholder:ha,withClearButton:!0})):null);return s.createElement(vt.a,{isRefreshing:n,onRefresh:this._handlePullToRefresh},c&&t?s.createElement(yt.a,{accessibilityRole:"tablist",accessibilityTitle:e,anchoring:Et,assumedItemHeight:100,cacheKey:c,footer:a,header:l,identityFunction:la,items:t,noItemsRenderer:i,onNearEnd:this._handleNearEnd,renderer:this._renderInboxItem(this.state.filterQuery),withHeadroom:!1,withKeyboardShortcuts:!r}):null)})),n()(this,"_handleNearEnd",(()=>{const{filterQuery:e}=this.state;e||this._handleHistoryRequest()})),n()(this,"_handleQueryChange",(e=>{this.setState({searchQuery:e})})),n()(this,"_handleSearchChangeInner",(e=>{const{analytics:t}=this.props;this.setState({filterQuery:e.toLowerCase()}),t.scribe({element:"thread",action:"search",data:{event_value:this.state.filterQuery.length}})})),n()(this,"_handleSearchChangeDebounced",Object(at.a)(this._handleSearchChangeInner,200)),n()(this,"_handleSearchChange",(({currentTarget:{value:e}})=>{this.state.showRecentSearches||this.setState({showRecentSearches:!0}),(e&&e.trim()||!e)&&(this._handleQueryChange(e),this._handleSearchChangeDebounced(e))})),n()(this,"_handleSearchClear",(()=>this._handleSearchChangeInner(""))),n()(this,"_handleSearchFocus",(()=>{this.props.conversationIds&&this.props.conversationIds.length<30&&this._handleHistoryRequest()})),n()(this,"_handleSearchClick",(()=>{const{analytics:e}=this.props;e.scribe({component:"search",action:"click"}),this.setState({showRecentSearches:!0})})),n()(this,"_hideRecentSearches",(()=>{this.setState({showRecentSearches:!1,searchQuery:""})})),n()(this,"_renderInboxItem",((e,t)=>(e,a)=>{const{loggedInUserId:r}=this.context,{filterQuery:n,searchQuery:o}=this.state,{isSecondaryInbox:c,isTertiaryInbox:l}=this.props,d=this._filterConversation(n),h=`/messages/${e}`,u=e&&null!=t&&t.length?t.indexOf(e):null;return aa()(!!r,"loggedInUserId must be defined"),a&&a(!0),s.createElement(i.a,{exact:!1,path:h},(t=>s.createElement(Ke,{conversationId:e,currentQuery:n,filter:d,isActive:t,isSecondaryInbox:!!c,isTertiaryInbox:!!l,key:e,link:h,onClick:this._handleConversationClick,perspective:r,searchIndex:u,searchQuery:o})))})),n()(this,"_filterConversation",(e=>e=>{const{filterQuery:t}=this.state;if(!t)return!0;const{loggedInUserId:a}=this.context,r=Object.keys(e.participants),n="GROUP_DM"===e.type&&e.name&&e.name.toLowerCase().indexOf(t)>-1,s=r.some((n=>{const s=e.participants[n],i=a===n,o=1===r.length&&i,c=s&&s.user&&!i;return!(!o&&!c)&&this._userMatchesQuery(s.user.screen_name,s.user.name,t)}));return!(!n&&!s)})),n()(this,"_handleFetchInitialWrapper",(()=>{this._handleFetchInitial()})),n()(this,"_handleFetchInitial",(()=>{const{createLocalApiErrorHandler:e,fetchInboxIfNeeded:t,fetchUpdates:a}=this.props;return t().then(this._updateLastSeenEventId,e()).then((()=>{this._updatePolling.start()})).then((()=>a().catch(e())))})),n()(this,"_handleConversationClick",((e,t,a,r)=>{const{customCellClick:n,analytics:s}=this.props,i=null!=r&&r.participants?Object.keys(r.participants).length:0,o=(null==r?void 0:r.type)===v.CONVERSATION_TYPE.GROUP;s.scribe({element:a?"muted_conversation":"thread",action:"click",data:{event_value:this.state.filterQuery.length,conversation_id:t,conversation_participant_count:i,conversation_type:o?j.a.GROUP:j.a.ONE_TO_ONE}}),n&&n(e,t)})),n()(this,"_handleEmptyDMInboxImpression",(()=>{const{analytics:e}=this.props;e.scribe({component:"empty_message",action:"impression"})})),n()(this,"_handlePullToRefresh",(()=>{const{createLocalApiErrorHandler:e,fetchInbox:t}=this.props;t().then(this._updateLastSeenEventId,e())})),n()(this,"_updateLastSeenEventIdIfActive",(()=>{if("background"!==ia.a.currentState)return this._updateLastSeenEventId()})),n()(this,"_updateLastSeenEventId",(()=>{const{createLocalApiErrorHandler:e,updateLastSeenEventId:t}=this.props;return t().catch(e())})),this._fab=s.createElement(ea,null),this._enableSearchInbox=!!e.withDmSearch&&this.context.featureSwitches.isTrue("responsive_web_search_dms_enabled"),this._isServerSearchEnabled=this._enableSearchInbox&&this.context.featureSwitches.isTrue("responsive_web_dm_server_side_search")}componentDidMount(){const{createLocalApiErrorHandler:e,fetchInboxHistory:t,fetchUpdates:a}=this.props;return this._updatePolling=new sa.a((()=>{a().then(this._updateLastSeenEventIdIfActive,e(ra.a))}),{interval:8e3}),this._handleHistoryRequest=Object(ca.a)(((...a)=>{t(...a).catch(e())}),1e3),this._handleFetchInitial()}componentWillUnmount(){this._updatePolling.stop()}render(){return s.createElement(na.a,null,s.createElement(y,null),s.createElement($t.a,{component:oa.a,fab:this._fab,style:pa.root},s.createElement(bt.a,{accessibilityLabel:da,fetchStatus:this.props.fetchStatus,onRequestRetry:this._handleFetchInitialWrapper,render:this._render})))}_userMatchesQuery(e,t,a){return e&&e.toLowerCase().indexOf(a)>-1||t&&t.toLowerCase().indexOf(a)>-1}}n()(ua,"contextType",o.a),n()(ua,"defaultProps",{conversationIds:[],isDrawer:!1,isSecondaryInbox:!1,isTertiaryInbox:!1,withDmSearch:!1});const pa=Re.a.create((e=>({root:{backgroundColor:e.colors.cellBackground,flexGrow:1},searchInput:{backgroundColor:e.colors.cellBackground,borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:"1px",padding:e.spaces.space12,zIndex:1}})));t.a=ua}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.DMDrawer.ad606c05.js.map