(window.webpackJsonp=window.webpackJsonp||[]).push([[158],{"3GUV":function(e,t,n){"use strict";var r=n("ERkP"),i=n("rHpw"),s=n("MWbm");class o extends r.Component{shouldComponentUpdate(){return!1}render(){return r.createElement(s.a,{style:a.root})}}const a=i.a.create((e=>({root:{height:5*e.lineHeightsPx.body}})));t.a=o},"5UID":function(e,t,n){"use strict";var r=n("ERkP"),i=n("3XMw"),s=n.n(i),o=n("rHpw"),a=n("+/1j"),c=n("MWbm");const l=s.a.e5b0063d;let h=0;class d extends r.Component{constructor(){super(),this._listDomId=`accessible-list-${h}`,h+=1}render(){const{children:e,title:t}=this.props,n=l({title:t});return r.createElement(c.a,{accessibilityLabelledBy:this._listDomId,accessibilityRole:"region"},r.createElement(a.a,{accessibilityLevel:1,accessibilityRole:"heading",nativeID:this._listDomId,style:o.a.visuallyHidden},t),r.createElement(c.a,{accessibilityLabel:n},e))}}t.a=d},JsJV:function(e,t,n){"use strict";var r=n("6/RC"),i=n("tI3i"),s=n.n(i),o=r.canUseDOM?window.location.href:"",a=function(){function e(){var e=this;this._eventCallbacks={},this.addEventListener=function(t,n){e._eventCallbacks[t]?e._eventCallbacks[t].push(n):e._eventCallbacks[t]=[n]},this.removeEventListener=function(t,n){var r=e._eventCallbacks[t].filter((function(e){return e.toString()!==n.toString()}));e._eventCallbacks[t]=r}}var t=e.prototype;return t._dispatchEvent=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=this._eventCallbacks[e];null!=i&&Array.isArray(i)&&i.map((function(e){e.apply(void 0,n)}))},t.canOpenURL=function(){return Promise.resolve(!0)},t.getInitialURL=function(){return Promise.resolve(o)},t.openURL=function(e){try{return c(e),this._dispatchEvent("onOpen",e),Promise.resolve()}catch(e){return Promise.reject(e)}},t._validateURL=function(e){s()("string"==typeof e,"Invalid URL: should be a string. Was: "+e),s()(e,"Invalid URL: cannot be empty")},e}(),c=function(e){if(r.canUseDOM){var t=new URL(e,window.location).toString();window.open(t,"_blank","noopener")}};t.a=new a},VeNJ:function(e,t,n){"use strict";n.r(t),n.d(t,"TimelineRenderer",(function(){return se}));var r=n("KEM+"),i=n.n(r),s=(n("kYxP"),n("n+Zb")),o=n("ERkP"),a=n("5UID"),c=n("6/RC"),l=n("1YZw"),h=n("rxPX"),d=Object(h.a)().propsFromActions((()=>({addToast:l.b}))).withAnalytics(),p=n("KNCp"),m=n("lUZE");var u=Object.freeze({Icon:"Icon",IconSmall:"IconSmall",FullWidth:"FullWidth"}),_=n("caTy"),b=n("TnY3"),y=n("TIdA"),g=n("A91F"),v=n("feu+"),f=n("JsJV"),C=n("MWbm"),E=n("oQhu"),w=n("fs1G"),I=n("rcen");class T extends o.PureComponent{constructor(...e){super(...e),i()(this,"_getGraphicProps",Object(E.a)(((e,t)=>{const n=e?({style:t})=>o.createElement(C.a,{style:t},o.createElement(y.a,{accessibilityLabel:"",aspectMode:g.a.exact(e.width/e.height),image:e})):m.a;let r="illustration";return e&&t!==u.IconSmall?t===u.FullWidth&&(r="illustrationFullWidth"):r="icon",{graphic:n,graphicDisplayMode:r}}))),i()(this,"_scribeAction",((e,t)=>{const{analytics:n}=this.props,{action:r,component:i,element:s}=t||{};n.scribe({action:r||e,component:i||"cover",element:s})})),i()(this,"_handleDismiss",(()=>{const{dismissInfo:e,processCallback:t}=this.props,{callbacks:n}=e||{};n&&n.forEach((e=>{t(e)})),e&&(this._scribeAction("dismiss"),this.props.onClose())})),i()(this,"_handlePrimaryCtaClick",(()=>{this._handleCtaClick(this.props.primaryCta,"primary_cta")})),i()(this,"_handleSecondaryCtaClick",(()=>{this.props.secondaryCta&&this._handleCtaClick(this.props.secondaryCta,"secondary_cta")})),i()(this,"_handleCtaClick",(({ctaBehavior:e,callbacks:t,clientEventInfo:n},r)=>{const{addToast:i,processCallback:s,history:o}=this.props;if(this.props.onClose(),this._scribeAction("click",{element:r,...n}),e.dismiss){const{dismiss:t}=e;t&&t.feedbackMessage&&i({text:t.feedbackMessage.text})}if(e.navigate){const{navigate:t}=e,n=t&&Object(_.b)(t.url);n&&(n.external?f.a.openURL(n.pathname):o.push(n.pathname))}t&&t.forEach((e=>s(e)))}))}componentDidMount(){this.props.onImpression&&this.props.onImpression()}render(){const{image:e,imageDisplayType:t,primaryText:n,primaryCta:r,secondaryText:i,secondaryCta:s,details:a,displayType:c,type:l,dismissInfo:h}=this.props,d=o.createElement(I.b,{entities:n.entities,text:n.text}),m=i?o.createElement(I.b,{entities:i.entities,text:i.text}):null;if(l===p.a.Full){const l=a?o.createElement(I.b,{entities:a.entities,text:a.text}):null,{graphic:p,graphicDisplayMode:u}=this._getGraphicProps(e,t);return o.createElement(v.a,{actionLabel:r.text,footer:l,footerAlign:a&&a.alignment===I.a.Center?"center":"left",graphic:p,graphicDisplayMode:u,headline:d,headlineAlign:n.alignment===I.a.Natural?"left":"center",isFullHeightOnMobile:!h&&"CenterCover"!==c,onAction:this._handlePrimaryCtaClick,onClose:this._handleDismiss,onTertiaryAction:this._handleSecondaryCtaClick,subtext:m,subtextAlign:i&&i.alignment===I.a.Natural?"left":"center",tertiaryActionLabel:s&&s.text,withCloseButton:!!h})}return o.createElement(v.a,{actionLabel:r.text,graphicDisplayMode:"none",headline:d,headlineAlign:n.alignment===I.a.Center?"center":"left",onAction:this._handlePrimaryCtaClick,onClose:w.a,onSecondaryAction:this._handleSecondaryCtaClick,secondaryActionLabel:s&&s.text,subtext:m,subtextAlign:i&&i.alignment===I.a.Center?"center":"left",withCloseButton:!1})}}i()(T,"defaultProps",{imageDisplayType:u.Icon});var k=Object(b.a)(d(T));const S={component:"cover",action:"impression"};var R=({activeCover:e,clearActiveCover:t,processCallback:n,scribeAction:r,scribeNamespace:i})=>{const s=((e,t)=>{let n={...e,...S};return t&&(n={...n,component:t.component||n.component,element:t.element||n.element,action:t.action||n.action}),n})(i,e.clientEventInfo),a=()=>{const{cover:{impressionCallbacks:t}}=e;t&&t.forEach((e=>n(e))),r(s)};return"full"===e.type?(c=e.cover,o.createElement(k,{details:c.details||void 0,dismissInfo:c.dismissInfo,displayType:c.displayType,image:c.image,imageDisplayType:c.imageDisplayType||void 0,onClose:t,onImpression:a,primaryCta:c.primaryCoverCta,primaryText:c.primaryText,processCallback:n,secondaryCta:c.secondaryCoverCta,secondaryText:c.secondaryText,type:"full"})):"half"===e.type?function(e){const r="CenterCover"===e.displayType?"full":"half";return o.createElement(k,{displayType:e.displayType,image:e.coverImage?e.coverImage.image:void 0,imageDisplayType:e.coverImage?e.coverImage.imageDisplayType:void 0,onClose:t,onImpression:a,primaryCta:e.primaryCoverCta,primaryText:e.primaryText,processCallback:n,secondaryCta:e.secondaryCoverCta,secondaryText:e.secondaryText,type:r})}(e.cover):null;var c},L=n("MDbM"),x=(n("C1yv"),n("Qyxo"));class A{constructor(){this._lingerScribed={},this._appearance={}}processPositioningUpdate(e,t,n=Date.now()){const r=D(e,t);return this._lingerTransition(r,n)}flushLingerEvents(e=Date.now()){return this._detectScribeLingerEvents(this._appearance,{},e)}_lingerTransition(e,t){const n=this._appearance;return this._appearance=e.reduce(((e,r)=>(e[r]=n[r]||{start:t,lingered:!1},e)),{}),{allLingerIds:this._detectAllLingerEvents(n,t),scribeLingerEvents:this._detectScribeLingerEvents(n,this._appearance,t)}}_detectAllLingerEvents(e,t){return Object.keys(e).reduce(((n,r)=>{const{start:i,lingered:s}=e[r];return!s&&t-i>=500&&(n.push(r),this._appearance[r]&&(this._appearance[r]={...this._appearance[r],lingered:!0})),n}),[])}_detectScribeLingerEvents(e,t,n){return Object.keys(e).reduce(((r,i)=>{const{start:s}=e[i];return!t[i]&&!this._lingerScribed[i]&&n-s>=500&&(this._lingerScribed[i]=!0,r.push({id:i,start:s,end:n})),r}),[])}}const D=(e,t)=>Object(x.a)(e,(({id:e,rectangle:n})=>N(n,t)>=.5*n.getHeight()?e:void 0)),N=(e,t)=>Math.max(0,Math.min(e.getBottom(),t.getBottom())-Math.max(e.getTop(),t.getTop()));var O=n("Stgo"),P=n("LFzM");var U=({children:e,impressionTracker:t})=>t?o.createElement(P.a.Provider,{value:{impressionTracker:t}},e):e,M=n("VPAj"),B=n("3GUV"),V=n("v//M"),F=n("rHpw");const j=Object(M.a)(o.createElement(B.a,null)),H=({bottomFetchStatus:e,onBottomRetry:t})=>o.createElement(C.a,{style:W.footer},o.createElement(V.a,{fetchStatus:e,onRequestRetry:t,render:j})),W=F.a.create((e=>({footer:{height:`calc(5 * ${e.lineHeights.body})`}})));var G=o.memo(H),K=n("xjVt"),J=n("EUHl"),z=n("IG4P"),q=n("iBK2"),Z=(n("rxtR"),n("pbku")),Y=n("aITJ"),Q=n("aWzz"),X=n("8UdT"),$=n("cFgU"),ee=n("iChn");const te=e=>e.entryId,ne=e=>e.sortIndex;const re=new Map,ie=(e,t)=>{if(!t)return Y.b.isDesktopOS()?100:400;switch(e){case X.b.Tweet:return 400;case X.a.ModuleImpressionPlaceholder:return 0;default:return 100}};class se extends o.PureComponent{constructor(e,t){var n;super(e,t),i()(this,"_renderLoadBottom",(()=>{const{bottomFetchStatus:e,onBottomRetry:t}=this.props;return o.createElement(G,{bottomFetchStatus:e,onBottomRetry:t})})),i()(this,"_refreshControlWrapper",(e=>{const{canRefresh:t,refreshControl:n,topFetchStatus:r,onRefresh:i}=this.props;return n?o.createElement(n,{canRefresh:t,isRefreshing:r===L.a.LOADING,onRefresh:i},e):e})),i()(this,"_getCellRenderer",Object(E.a)(((e,t)=>{let n;const r={module:t,renderEntry:e=>n(e)};return n=(t,n)=>{const i=e.getHandler(t);return i&&i.render?i.render(t,r,n):null},n}))),i()(this,"_getInitialFocusedEntry",Object(E.a)(((e,t)=>t&&e.find(t)))),i()(this,"_createEntryIndex",Object(E.a)((e=>Object(ee.a)(e,(e=>e.entryId))))),i()(this,"_handleBeforeWindowUnload",(()=>{this._flushLingerScribes()})),i()(this,"_handleKeyboardRefresh",(()=>{this.refreshOrGoTop(!0)})),i()(this,"scrollToTop",(e=>{this._scroller&&this._scroller.scrollToTop(e)})),i()(this,"_handleAtBottom",this._proximityHandler((()=>{this.props.onAtBottom&&this.props.onAtBottom()}))),i()(this,"_handleNearBottom",this._proximityHandler((()=>{this.props.onNearBottom()}))),i()(this,"_handleNearTop",this._proximityHandler((()=>{const{onNearTop:e}=this.props;e()}))),i()(this,"_handleAtTop",this._proximityHandler((()=>{this.props.removeAlert&&this.props.removeAlert(),this.props.onAtTop&&this.props.onAtTop()}))),i()(this,"_handleItemsRendered",this._proximityHandler((({viewport:e,positions:t})=>{if(this.props.onEntriesRendered&&this.props.onEntriesRendered(),!this._V2ImpressionsEnabled()){const n=this._impressionTracker.processPositioningUpdate(t,e);this._scribeLingerEvents(n.scribeLingerEvents),this._handleOnLingerEvents(n.allLingerIds)}}))),i()(this,"_handleProcessLingerEvents",(()=>{if(this._impressionTrackerV2){const e=this._impressionTrackerV2.getLingerEvents();this._scribeLingerEvents(e)}})),i()(this,"_handleOnLingerEvents",(e=>{e.forEach((e=>this._handleOnLingerEvent(e)))})),i()(this,"_handleOnLingerEvent",(e=>{const{applyReactionInstructions:t}=this.props,n=this._getEntryIndex()[e];n&&t({entry:n,triggerName:Z.a.ON_LINGER})})),i()(this,"_handlePositionRestored",(()=>{this._positionedRestored=!0})),i()(this,"_scheduleNewEntriesScribing",(n=e=>{const{richScribeAction:t,scribeNamespace:n}=this.props,r=this._buildStreamScribeData(e);r.length>0&&t({...n,component:"stream",action:"results"},{items:r})},c.canUseDOM&&window.requestIdleCallback?e=>{const t=window.requestIdleCallback((()=>n(e)));return()=>window.cancelIdleCallback(t)}:c.canUseDOM&&window.requestAnimationFrame?e=>{const t=window.requestAnimationFrame((()=>n(e)));return()=>window.cancelAnimationFrame(t)}:()=>w.a)),i()(this,"_setScroller",(e=>{this._scroller=e})),i()(this,"_V2ImpressionsEnabled",(()=>{var e;return c.canUseDOM&&(null==(e=this.context.featureSwitches)?void 0:e.isTrue("responsive_web_linger_refactor_enabled"))})),i()(this,"_newImpressionTrackerV2",(()=>this._V2ImpressionsEnabled()&&window.IntersectionObserver?new O.a({root:this.context.viewport.getViewport(),reactivityCallback:this._handleOnLingerEvent}):void 0)),this._impressionTracker=new A,this._streamScribeCancelCallbacks=[],this._impressionTrackerV2=this._newImpressionTrackerV2()}UNSAFE_componentWillReceiveProps(e){this.props.timelineId!==e.timelineId&&(this._flushLingerScribes(),this._impressionTracker=new A,this._impressionTrackerV2&&this._impressionTrackerV2.disconnect(),this._impressionTrackerV2=this._newImpressionTrackerV2())}componentDidMount(){const{onRef:e}=this.props;this._initialize(),window.addEventListener("beforelogout",this._handleBeforeWindowUnload),window.addEventListener("beforeunload",this._handleBeforeWindowUnload),e&&e(this)}componentWillUnmount(){var e;const{onRef:t}=this.props;this._flushLingerScribes(),this._cancelStreamScribeCallbacks(),window.removeEventListener("beforelogout",this._handleBeforeWindowUnload),window.removeEventListener("beforeunload",this._handleBeforeWindowUnload),t&&t(void 0),null==(e=this._impressionTrackerV2)||e.disconnect()}componentDidUpdate(e){const{entries:t,handlerRegistry:n,timelineId:r,onRef:i}=this.props;r!==e.timelineId?this._initialize():t===e.entries&&n===e.handlerRegistry||this._scribeNewEntries(t),i&&i!==e.onRef&&i(this)}render(){const{anchoring:e,entries:t,handlerRegistry:n,showFooter:r,header:i,isInitialFocusEntry:c,nearStartProximityRatio:l,renderEmptyState:h,timelineId:d,title:p,module:m,withKeyboardShortcuts:u}=this.props,_=this.props.scroller,b=this._getInitialFocusedEntry(t,c),y=this._V2ImpressionsEnabled()?this._handleProcessLingerEvents:w.a;return this._refreshControlWrapper(this._shouldRenderEmptyState(t)?h():o.createElement(U,{impressionTracker:this._impressionTrackerV2},o.createElement(a.a,{title:p},this._renderActiveCover(),this._renderPill(),o.createElement(_,{anchoring:e,assumedItemHeight:ie,cacheKey:d,footer:r&&this._renderLoadBottom(),header:i,identityFunction:te,initialAnchor:b&&s.b(te(b)),items:t,nearStartProximityRatio:l,onAtEnd:this._handleAtBottom,onAtStart:this._handleAtTop,onItemsRendered:this._handleItemsRendered,onKeyboardRefresh:this._handleKeyboardRefresh,onNearEnd:this._handleNearBottom,onNearStart:this._handleNearTop,onPositionRestored:this._handlePositionRestored,onScrollEnd:y,ref:this._setScroller,renderer:this._getCellRenderer(n,m),sortIndexFunction:ne,withKeyboardShortcuts:u}))))}_renderPill(){const{alert:e,removeAlert:t,topUnseenCount:n,newTweetsPillMode:r,scribeNamespace:i,timelineId:s}=this.props;return r?r===J.a.URT?o.createElement(K.a.Configure,{alert:e,removeAlert:t,scribeNamespace:i,timelineId:s}):r===J.a.CLIENT&&n&&n>0?o.createElement(K.a.Configure,{removeAlert:t,scribeNamespace:i,timelineId:s,unreadCount:n}):void 0:null}_renderActiveCover(){const{activeCover:e,clearActiveCover:t,processCallback:n,scribeAction:r,scribeNamespace:i}=this.props,s=e&&e.cover;return e&&s?o.createElement(R,{activeCover:e,clearActiveCover:t,processCallback:n,scribeAction:r,scribeNamespace:i}):null}_shouldRenderEmptyState(e){const{activeCover:t,initialFetchStatus:n}=this.props,r=n===L.a.LOADED,i=0===e.length;return r&&i&&!t}_getEntryIndex(){return this._createEntryIndex(this.props.entries)}_initialize(){this._scribeNewEntries(this.props.entries)}_flushLingerScribes(){const e=this._impressionTrackerV2?this._impressionTrackerV2.flushLingerEvents():this._impressionTracker.flushLingerEvents();this._scribeLingerEvents(e)}refreshOrGoTop(e){this._scroller&&!this._scroller.isAtTop()?this.scrollToTop(e):this.props.onRefresh()}_proximityHandler(e){return t=>{this._positionedRestored&&e(t)}}_scribeNewEntries(e){const t=this._scheduleNewEntriesScribing(e);for(this._streamScribeCancelCallbacks.push(t);this._streamScribeCancelCallbacks.length>=20;)this._streamScribeCancelCallbacks.shift()}_buildStreamScribeData(e){const{scribeCache:t,timelineId:n,handlerRegistry:r}=this.props;let i=null;if(!t.has(n)){const e=new Set;t.set(n,e)}const s=t.get(n);return s?e.reduce(((e,t,n)=>{const{entryId:o}=t;let a=!1;if(t.content&&t.content.promotedMetadata&&(a=t.content.promotedMetadata),!s.has(o)&&!r.getNeedsLoad(t)){s.add(o);const n=this._getScribeDataItem(r,t);n&&(a&&null!==i&&(n.tweet_count=i),e.push(n))}return a?i=0:null!==i&&-1===t.type.indexOf("ui_")&&(i+=1),e}),[]):[]}_storeSeenIds(e){const{seenIds:t,seenIdsLatest:n,timelineId:r}=this.props;"home"===r&&t?t.addNewTweets(e):"home-latest"===r&&n&&n.addNewTweets(e)}_scribeLingerEvents(e){if(0===e.length)return;const{handlerRegistry:t}=this.props,n=this._getEntryIndex(),r=[],i=[];if(e.forEach((({id:e,start:s,end:o})=>{const a=n[e];if(a){const e=this._getScribeDataItem(t,a);if(e){const t={visibility_start:s,visibility_end:o};r.push({...e,impression_details:t})}a.type===X.b.Tweet&&i.push(a.content.id)}})),r.length>0){const{richScribeAction:e,scribeNamespace:t}=this.props;e({...t,component:"stream",element:"linger",action:"results"},{items:r})}i.length>0&&this._storeSeenIds(i)}_getScribeDataItem(e,t){const n=e.getHandler(t);if(n)return n.getScribeDataItem(t)}_cancelStreamScribeCallbacks(){this._streamScribeCancelCallbacks.forEach((e=>e()))}}i()(se,"contextTypes",{viewport:Q.object,featureSwitches:Q.any}),i()(se,"defaultProps",{onBottomRetry:w.a,onNearBottom:w.a,onNearTop:w.a,onRefresh:w.a,refreshControl:z.a,scribeCache:re,scroller:q.b,seenIds:Object($.b)(),seenIdsLatest:Object($.a)(),showFooter:!0,withKeyboardShortcuts:!0});t.default=se},"n+Zb":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));const r=e=>({id:e,distanceToViewportTop:0}),i=e=>({id:e,distanceToViewportBottom:0})}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.TimelineRenderer.65f94405.js.map