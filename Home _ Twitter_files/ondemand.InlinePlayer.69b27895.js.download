(window.webpackJsonp=window.webpackJsonp||[]).push([[183],{"38Al":function(e,t,s){"use strict";var i=s("ERkP"),n=s("rHpw"),r=s("MWbm");const a=e=>{e.preventDefault(),e.stopPropagation()};t.a=({children:e,testID:t})=>i.createElement(r.a,{onClick:a,style:n.a.absoluteFill,testID:t},e)},"64vW":function(e,t,s){"use strict";var i=s("ERkP");const n=i.createContext({heightsReady:!0});t.a=n},QHXq:function(e,t,s){"use strict";s.r(t),s.d(t,"InlinePlayerContainer",(function(){return K}));var i=s("97Jx"),n=s.n(i),r=s("KEM+"),a=s.n(r),o=s("ERkP"),l=s("rxPX"),c=s("0KEI"),h=s("6rlp"),p=s("H9MA"),d=s("RqPI"),u=s("yr4d"),_=s("XOJV"),y=s("eXeu");const m=()=>(e,t,{api:s})=>s.getHttpClient(),b=(e,t)=>{const s=t.source&&t.source.videoId;return s&&"tweet"===s.type?s.id:void 0};var P=Object(l.a)().propsFromState((()=>({dataSaverMode:p.c,language:d.g,sourceTweet:_.a.createHydratedTweetSelector(b)}))).adjustStateProps((({dataSaverMode:e,language:t,sourceTweet:s})=>({dataSaverMode:e,language:t,mediaAvailability:s&&Object(y.b)(s)||void 0,publisherId:s?Object(y.c)(s):void 0}))).propsFromActions((()=>({createLocalApiErrorHandler:Object(c.d)("INLINE_PLAYER_CONTAINER"),getTwitterAuthedHttpClient:m,logPromotedVideoEvent:h.b,tweetAdProvider:u.b}))).withAnalytics(),g=s("6v1f"),v=s("ZeN/"),I=s("38Al"),f=s("epkG"),C=s("mN6z"),A=(s("u+Xj"),s("ylrv"));class w{constructor(e,t,s){this.placement=e,this.obstructions=t,this.layerId=s}getPositionData(){return{percentVisible:this.visibleFraction(),percentOfViewportOccupied:this.placement.viewportOccupiedFraction(),sizesInfo:{viewportSize:this.placement.viewport,mediaSize:this.placement.item}}}visibleFraction(){const e=this.placement.visiblePart();if(!e)return 0;const t=this.layerId?this.obstructions.getObstructionAboveLayer(this.layerId,e):this.obstructions.getTotalObstruction(e),s=A.a.area(this.placement.item),i=(1-t)*A.a.area(e);return s>0?i/s:0}top(){return this.placement.item.top}distanceToCenter(){return this.placement.verticalDistanceToViewportCenter()}distanceToTop(){return this.placement.verticalDistanceToViewportTop()}scrollY(){return this.placement.scrollY}}var E=s("efbI"),R=s("mf9H"),S=s("zHh/"),F="videoPlayer",T=s("v/3V"),O=s("aITJ"),k=s("Xq8B"),x=s("Zl35"),H=s("9Xij"),M=s("rHpw"),D=s("HT/6"),L=s("v6aA"),j=s("iOGT"),U=(s("kYxP"),s("gZV8")),V=s("7nmT"),N=s.n(V),z=s("vF3p"),q=s("S4UJ");class X extends o.Component{constructor(...e){super(...e),a()(this,"_handleIntersectionChange",(()=>{const{onChange:e}=this.props;this.sample(e)})),a()(this,"_handlePlacementChange",(e=>{this._updateAndNotify({placement:e},this.props.onChange)})),a()(this,"_handleObstructionChange",(()=>{const{obstructionDetection:e,onChange:t}=this.props;this._updateAndNotify({obstructions:e.getObstructions()},t)})),a()(this,"_disconnectPlacementObserver",(()=>{this._intersectionObserver&&this._intersectionObserver.disconnect()})),a()(this,"_observePlacement",(()=>{if(window.IntersectionObserver&&this._placementRef){const e=N.a.findDOMNode(this._placementRef);if(this._element=e&&e instanceof window.HTMLElement?e:void 0,this._element){const e={threshold:[0,R.a,.5,1]};this._intersectionObserver=new window.IntersectionObserver(this._handleIntersectionChange,e),this._intersectionObserver.observe(this._element)}}})),a()(this,"_setPlacementRef",(e=>{const{setAPI:t}=this.props;this._placementRef=e,this._observePlacement(),t(this._placementRef?{sample:e=>this.sample(e),signalFullscreenEntered:this._disconnectPlacementObserver,signalFullscreenExited:this._observePlacement}:void 0)}))}sample(e){this._placementRef&&this._placementRef.sample((t=>{this._updateAndNotify({placement:t},e)}))}render(){const{children:e,style:t}=this.props;return o.createElement(U.a,{onPlacementChange:this._handlePlacementChange,ref:this._setPlacementRef,style:t},e)}componentDidMount(){const{obstructionDetection:e}=this.props;this._obstructionSubscription=e.subscribe(this._handleObstructionChange)}componentWillUnmount(){this._obstructionSubscription&&(this._obstructionSubscription.unsubscribe(),this._obstructionSubscription=void 0),this._disconnectPlacementObserver()}_updateAndNotify({placement:e,obstructions:t},s){const{layerId:i,obstructionDetection:n}=this.props;this._placement=e||this._placement,this._obstructions=t||this._obstructions||n.getObstructions(),this._placement?s(new w(this._placement,this._obstructions,i)):this._placementRef&&this._placementRef.sample((e=>{this._placement=e,this._obstructions=this._obstructions||n.getObstructions(),s(new w(e,this._obstructions,i))}))}}a()(X,"defaultProps",{obstructionDetection:z.a});var B=Object(q.a)(X);const W=new f.a({});class J extends o.Component{constructor(e,t){super(e,t),a()(this,"_emitter",null),a()(this,"_playerInternal",null),a()(this,"_placementRef",null),a()(this,"_isLooping",!1),a()(this,"_isPlayerFullscreen",!1),a()(this,"_renderHorizonPlayer",(e=>{const{accessibilityLabel:t,analytics:s,aspectRatio:i,source:{contentId:r,eventId:a,videoId:l,vmapUrl:c},displayOptions:h,durationMs:p,intentToPlayTime:d,playerId:u,videoEl:_,viewCount:y,includeBroadcastEventAssociation:m,geolocationPrompt:b,timecode:P,mediaAvailability:g,noAuthHttpClient:v,publisherId:I,twitterAuthedHttpClient:f,language:C,maxLoopCount:A,videoPlayer:w,uiStack:R}=this.props;return o.createElement(E.a.Consumer,null,(({prerollDisplayLocation:E})=>o.createElement(x.b,n()({accessibilityLabel:t,adProvider:this._tweetAdProvider(E),analytics:s,aspectRatio:i,basePlayerClass:w,configType:"static",contentId:r,cta:this._getPlayerCTA(),disableHls:this._disableHls,durationMs:p,eventId:a,featureProvider:this.context.featureSwitches,geolocationPrompt:b,httpClient:v,includeBroadcastEventAssociation:m,initiallyMutedCaptions:!0,intentToPlayTime:d,language:C,maxLoopCount:A,mediaAvailability:g,objectFitVideo:h&&h.objectFitVideo,onApiReady:this._handleApiReady,playbackSessionId:l.id,playerId:u,precache:this._shouldAutoplay,publisherId:I,requestedTimecode:P,twitterAuthedHttpClient:f,videoEl:_,videoId:l,viewCount:y,vmapUrl:c},e),R)))})),a()(this,"_setPlayerApi",(e=>{const{onMuteChange:t,customOverlay:s,onSetPlayerApi:i}=this.props;"function"==typeof s&&(this._playerInternal=e,this.forceUpdate()),t&&(e.on("unmute",(()=>t({isPlayerMuted:!1}))),e.on("mute",(()=>t({isPlayerMuted:!0})))),e&&(e.on("fullscreenEntered",(()=>this._handleFullscreenChange({isPlayerFullscreen:!0}))),e.on("fullscreenExited",(()=>this._handleFullscreenChange({isPlayerFullscreen:!1})))),this._setPlayerInternal(e),i&&i(e)})),a()(this,"_getPlayerCTA",(()=>{const{cta:e,promotedContent:t}=this.props;return e&&{...e,url:Object(T.a)(this.context.featureSwitches,e.url,null==t?void 0:t.click_tracking_info)}})),a()(this,"_handleApiReady",this._setPlayerApi),a()(this,"_getLoopingThreshold",(()=>{const{loopingThresholdMs:e,source:{videoId:t}}=this.props;return e||"tweet"===t.type&&6e4||7e3})),a()(this,"_handleAutoPlayRequest",(()=>{const{onAutoplay:e,shouldAutoplayWithoutMuting:t,isFleet:s}=this.props;!s&&this._playerInternal&&(t?this._playerInternal.play():this._playerInternal.playPreview(),e&&e())})),a()(this,"_handlePauseRequest",(()=>{const{onAutopause:e}=this.props;this._playerInternal&&(this._playerInternal.pause(),e&&e())})),a()(this,"_handlePlacementChange",(e=>{this._emitter&&!this._isPlayerFullscreen&&this._emitter.signalPlacementChange(e),this._playerInternal&&!this._isPlayerFullscreen&&this._playerInternal.updatePosition(e.getPositionData())})),a()(this,"_handlePlaybackComplete",(()=>{const{onPlaybackComplete:e}=this.props;this._emitter&&this._emitter.signalPlaybackFinish(),e&&e()})),a()(this,"_handlePlaybackStarted",(()=>{this._emitter&&this._emitter.signalPlay(),this.props.onPlaybackStarted&&this.props.onPlaybackStarted()})),a()(this,"_handlePlaybackPaused",(()=>{this._emitter&&this._emitter.signalPause()})),a()(this,"_handlePlayerState",(e=>{const{onPlayerState:t,onProgressChange:s}=this.props;t&&t(e);const i=(e.tracks||[]).find((t=>t.id===e.currentTrackId));if(i){const t=(i.currentTimeMs||0)/i.durationMs;s&&s(t,e.tracksFinished)}})),a()(this,"_handleError",(e=>{const{onError:t}=this.props,{error:s}=e;s?(this._emitter&&(this._emitter.unregister(),this._emitter=void 0,this._hasInitialPlacementMeasurement=!1,this._lastPlayerError=s),e.errorInfo&&!e.errorInfo.canRetry&&(t&&t(),this._onErrorUnsubscribe&&this._onErrorUnsubscribe())):!this._emitter&&this._lastPlayerError&&(this._registerPlaybackCoordination(),this._submitInitialPlacement(),this._lastPlayerError=void 0)})),a()(this,"_handleFullscreenChange",(e=>{const t=this.context.viewport;if(this._isPlayerFullscreen=e.isPlayerFullscreen,t){if(t.temporarilySuppressScrollListeners(2e3),O.b.isChrome()||O.b.isSafari())if(this._isPlayerFullscreen)this._savedScrollPosition={y:t.scrollY(),x:t.scrollX()};else if(this._savedScrollPosition){const{x:e,y:s}=this._savedScrollPosition;this._savedScrollPosition=void 0,t.scrollTo(e,s)}this._isPlayerFullscreen&&this._playerInternal?this._playerInternal.updatePosition({percentVisible:1,percentOfViewportOccupied:1,sizesInfo:{viewportSize:t.getRect2D(),mediaSize:t.getRect2D()}}):!this._isPlayerFullscreen&&this._placementRef&&this._placementRef.sample(this._handlePlacementChange)}const{onFullscreenChange:s}=this.props;s&&s(e),this._emitter&&this._emitter.signalFullscreenChange(e.isPlayerFullscreen)})),a()(this,"_handleFullscreenEntered",(()=>{this._placementRef&&this._placementRef.signalFullscreenEntered()})),a()(this,"_handleFullscreenExited",(()=>{this._placementRef&&this._placementRef.signalFullscreenExited()})),a()(this,"_registerPlaybackCoordination",(()=>{const{isFleet:e,playbackCoordination:t,playbackPriority:s}=this.props,i={onAutoPlayRequest:this._handleAutoPlayRequest,onFullscreenEntered:this._handleFullscreenEntered,onFullscreenExited:this._handleFullscreenExited,onPauseRequest:this._handlePauseRequest,canAutoplay:!e&&this._shouldAutoplay,isLooping:this._isLooping,playbackPriority:s};t&&(this._emitter=t.register(i))})),a()(this,"_setPlayerInternal",(e=>{if(this._playerInternal=e,e){const{onPlayerState:t,onProgressChange:s}=this.props;(t||s)&&e.subscribe(this._handlePlayerState),this._onErrorUnsubscribe=e.subscribe(this._handleError),e.on("playbackComplete",this._handlePlaybackComplete),e.on("play",this._handlePlaybackStarted),e.on("pause",this._handlePlaybackPaused),this._registerPlaybackCoordination(),this._submitInitialPlacement()}if(this.props.setPlayer){const e=this._playerInternal&&{play:()=>{this._playerInternal&&this._playerInternal.play()},pause:()=>{this._playerInternal&&this._playerInternal.pause()},replay:()=>{this._playerInternal&&this._playerInternal.replay()}};this.props.setPlayer(e)}})),a()(this,"_setPlacementAPI",(e=>{this._placementRef=e,this._submitInitialPlacement()})),a()(this,"_getTweetId",(()=>{const{source:{videoId:e}}=this.props;if(e){if("tweet"===e.type)return e.id;if("broadcast"===e.type)return e.tweetId}})),a()(this,"_tweetAdProvider",(e=>{const t=this._getTweetId();if(t)return()=>this.props.tweetAdProvider(t,e)}));const{autoplay:s,forwardPivotInfo:i}=e;this._disableHls=!(O.b.isDesktopOS()||O.b.isAndroid()&&this.context.featureSwitches.isTrue("web_video_hls_android_mse_enabled")),this._shouldAutoplay=Object(S.a)(s,i)}componentDidUpdate(e){const{heightsReady:t}=this.props;!e.heightsReady&&t&&this._submitInitialPlacement()}render(){const{aspectRatio:e}=this.props;return o.createElement(H.a,{ratio:e,style:Y.aspectRatio},o.createElement(B,{onChange:this._handlePlacementChange,setAPI:this._setPlacementAPI,style:M.a.absoluteFill},this._renderPlayer()))}UNSAFE_componentWillReceiveProps(e){Object(C.a)(this.props.source,e.source)||this._emitter&&this._emitter.reset()}componentWillUnmount(){this._emitter&&(this._emitter.unregister(),this._emitter=null),this._onErrorUnsubscribe&&this._onErrorUnsubscribe()}_renderPlayer(){const{source:{variants:e},durationMs:t,forceLoop:s,videoType:i,isFleet:n,poster:r,promotedContent:a,dataSaverMode:l}=this.props,c="animated_gif"===i,h="vine"===i,p=e&&e.length?c?"gif":"media_entity":"vmap";this._isLooping=!!(s||c||h||t&&t<=this._getLoopingThreshold());const d={bitrateCap:l?v.a.MEDIUM:void 0,contentType:p,loop:!n&&this._isLooping,poster:r&&r.url,promotedContext:a&&(a.impression_id||a.disclosure_type)?{impressionId:a.impression_id,disclosureType:a.disclosure_type}:void 0,variants:e&&Object(y.e)(Object(j.b)(e,l?j.a.MEDIUM:j.a.HIGH).map((e=>({src:e.url,type:e.content_type}))))||[]};return o.createElement(I.a,{testID:F},this._renderHorizonPlayer(d))}_submitInitialPlacement(){const{heightsReady:e}=this.props,t=e&&!this._hasInitialPlacementMeasurement;this._emitter&&this._placementRef&&t&&(this._placementRef.sample(this._handlePlacementChange),this._hasInitialPlacementMeasurement=!0)}}a()(J,"contextType",L.a),a()(J,"defaultProps",{autoplay:g.b.Off,playbackCoordination:R.c,playbackPriority:D.a.NORMAL,showControls:!0,dataSaverMode:!1,geolocationPrompt:!0,heightsReady:!0,noAuthHttpClient:W,includeBroadcastEventAssociation:!1});const Y=M.a.create({aspectRatio:{zIndex:void 0}});var G=s("fs1G"),Z=s("64vW");class K extends o.PureComponent{constructor(e,t){super(e,t),a()(this,"_player",null),a()(this,"_getBaseItem",(e=>{const{analytics:t,includeBroadcastEventAssociation:s,source:{videoId:i}}=this.props,{event_id:n}=t.contextualScribeData;let r;return r="broadcast"===i.type&&i.tweetId?i.tweetId:"broadcast"===i.type&&s&&n?n:i.id,e.find((e=>e.id===r))})),a()(this,"_createAnalytics",(e=>{const t={log:this._scribeAction},{analytics:s}=this.props,i={log:this.context.featureSwitches.isTrue("responsive_web_video_promoted_logging_enabled")?this._logPromotedVideoEvent:G.a},n=s.contextualScribeNamespace,r=s.contextualScribeData,a={scribeContext:{...n},baseScribeItem:Array.isArray(r.items)?this._getBaseItem(r.items):void 0,enableShortFormCompleteLogging:this.context.featureSwitches.isTrue("responsive_web_video_pcomplete_enabled")};return new k.a(t,i,e,a)})),a()(this,"_logPromotedVideoEvent",(e=>{const{createLocalApiErrorHandler:t}=this.props;this.props.logPromotedVideoEvent(e).catch(t())})),a()(this,"_scribeAction",(e=>{const{category:t,data:s,namespace:i}=e,{analytics:n}=this.props;null!=i&&i.action&&n.scribe({...i,data:{...s,_category_:t}})})),a()(this,"_setPlayer",(e=>{if(this._player=e,this.props.setPlayer){const e=this._player&&{play:()=>{this._player&&this._player.play()},pause:()=>{this._player&&this._player.pause()},replay:()=>{this._player&&this._player.replay()}};this.props.setPlayer(e)}})),this._twitterAuthedHttpClient=e.getTwitterAuthedHttpClient(),this._analytics=this._createAnalytics(this._twitterAuthedHttpClient)}render(){const{createLocalApiErrorHandler:e,getTwitterAuthedHttpClient:t,tweetAdProvider:s,...i}=this.props;return o.createElement(Z.a.Consumer,null,(({heightsReady:e})=>o.createElement(J,n()({},i,{analytics:this._analytics,heightsReady:e,setPlayer:this._setPlayer,tweetAdProvider:s,twitterAuthedHttpClient:this._twitterAuthedHttpClient}))))}}a()(K,"contextType",L.a);const Q=P(K);t.default=Q}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/ondemand.InlinePlayer.69b27895.js.map